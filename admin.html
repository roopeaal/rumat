<!doctype html>
<html lang="fi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>RUMAT Admin</title>
  <style>
    :root{--ink:#202020;--edge:#dadada}
    body{font:16px system-ui,Segoe UI,Inter,sans-serif;background:#f6f6f4;color:var(--ink);margin:0}
    .wrap{max-width:920px;margin:40px auto;padding:20px;background:#fff;border:1px solid var(--edge);border-radius:14px}
    h1{margin:0 0 10px 0}
    .row{display:flex;gap:.6rem;flex-wrap:wrap;margin:.6rem 0}
    input,button,textarea{font:inherit}
    input{padding:.55rem .7rem;border:1px solid var(--edge);border-radius:10px}
    button{padding:.55rem 1rem;border-radius:9999px;border:1px solid #2a2a2a;background:#202020;color:#fff;cursor:pointer}
    button.secondary{background:#789FAB;border-color:#789FAB}
    textarea{width:100%;min-height:380px;padding:.8rem;border:1px solid var(--edge);border-radius:12px;font-family:ui-monospace,SFMono-Regular,Menlo,monospace}
    .hint{font-size:.9rem;color:#666}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:.6rem}
    label{font-size:.9rem;color:#444}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>RUMAT Admin</h1>
    <p class="hint">Kirjaudu salasanalla, lataa nykyinen sisältö, muokkaa ja tallenna. Salasana ei koskaan näy sivukoodissa – se tarkistetaan Workerissa.</p>

    <div class="row">
      <input id="pwd" type="password" placeholder="Salasana">
      <button id="login">Kirjaudu</button>
      <button id="logout" class="secondary">Ulos</button>
    </div>

    <div class="grid">
      <div>
        <label>Hero-otsikko</label>
        <input id="f_headline" placeholder="LIIAN RUMAT OLLAKSEEN TOTTA">
      </div>
      <div>
        <label>Hero-kuvan URL</label>
        <input id="f_image" placeholder="https://images.unsplash.com/...">
      </div>
    </div>

    <div class="row">
      <button id="pull" class="secondary">Lataa sisältö</button>
      <button id="push">Tallenna sisältö</button>
    </div>

    <textarea id="json" placeholder='{"brandName":"RUMAT.STUDIO","hero":{"headline":"...","image":"..."}, "products":[...]}'></textarea>
    <pre id="out" class="hint"></pre>

    <p class="hint">Vinkki: pidä rakenne muodossa
    <code>{"brandName","hero":{"headline","image"},"products":[{"id","name","price","description","images":[...] }],"contact":{"email","instagram","location","shipping"}}</code>.
    </p>
  </div>

  <script>
    const API_BASE = "https://rumat-backend.roope-aa.workers.dev"; // <-- VAIHDA OMA URL
    const out = (m)=> document.getElementById('out').textContent =
      (typeof m==='string') ? m : JSON.stringify(m,null,2);

    // Pieni apu: synkkaa lomake <-> textarea
    function applyFormToJson(){
      let data = {};
      try{ data = JSON.parse(document.getElementById('json').value || "{}"); }catch{}
      if(!data.hero) data.hero = {};
      const headline = document.getElementById('f_headline').value.trim();
      const image    = document.getElementById('f_image').value.trim();
      if(headline) data.hero.headline = headline;
      if(image)    data.hero.image    = image;
      document.getElementById('json').value = JSON.stringify(data,null,2);
    }
    function applyJsonToForm(){
      try{
        const data = JSON.parse(document.getElementById('json').value || "{}");
        document.getElementById('f_headline').value = data?.hero?.headline || "";
        document.getElementById('f_image').value    = data?.hero?.image || "";
      }catch{}
    }

    document.getElementById('login').onclick = async () => {
      const password = document.getElementById('pwd').value;
      const r = await fetch(`${API_BASE}/api/login`, {
        method:'POST', credentials:'include',
        headers:{'content-type':'application/json'},
        body: JSON.stringify({ password })
      });
      out(await r.json());
    };

    document.getElementById('logout').onclick = async () => {
      const r = await fetch(`${API_BASE}/api/logout`, {
        method:'POST', credentials:'include'
      });
      out(await r.json());
    };

    document.getElementById('pull').onclick = async () => {
      const r = await fetch(`${API_BASE}/api/content`, { credentials:'include' });
      const text = await r.text();
      document.getElementById('json').value = text || "{}";
      applyJsonToForm();
      out("Ladattu.");
    };

    document.getElementById('push').onclick = async () => {
      applyFormToJson();
      const body = document.getElementById('json').value || "{}";
      try{ JSON.parse(body); }catch{ return out("Virhe: JSON ei ole kelvollinen"); }
      const r = await fetch(`${API_BASE}/api/content`, {
        method:'PUT', credentials:'include',
        headers:{'content-type':'application/json'},
        body
      });
      out(await r.json());
    };

    // Päivitä tekstialueen muutoksista lomakekenttiin
    document.getElementById('json').addEventListener('input', applyJsonToForm);
  </script>
</body>
</html>
