<!doctype html>
<html lang="fi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>RUMAT STUDIO</title>

  <!-- Montserrat -->
  <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800;900&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root{
      --ink:#202020;        /* musta (tekstit) */
      --olive:#A1A266;      /* footer-tausta */
      --deep-blue:#345563;  /* otsikot */
      --blue:#789FAB;       /* varalle */
      --light-blue:#DEEEEE; /* footer-logo tausta / tehoste */
      --ivory:#F6F6F4;      /* taustat & yläpalkki */
      --header-h:64px;
      --band-radius:16px;
    }
    html{ scroll-padding-top: var(--header-h); }
    body{ font-family:Montserrat,system-ui,Segoe UI,Roboto,Arial; color:var(--ink); background:var(--ivory); }
    h1,h2,h3{ color:var(--deep-blue); font-weight:800; }  /* otsikot lihavoitu */
    .hero h1{ color:#fff; } /* “Liian rumat…” pysyy valkoisena */

    /* Header */
    header{ background:var(--ivory); border-bottom:1px solid rgba(0,0,0,.08); }
    #hdrRow{ grid-template-columns:auto 1fr auto; }
    #brandText{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:min(42vw, 460px); color:var(--ink); }
    #mainNav{ justify-self:center; display:flex; gap:1.5rem; white-space:nowrap; font-size:13px; text-transform:uppercase; letter-spacing:.2em; color:var(--ink); }
    #mainNav a{ color:var(--ink); }

    /* Responsive nav helpers */
    .nav-hidden{ display:none !important; }
    .nav-measure{ position:absolute !important; visibility:hidden !important; display:flex !important; white-space:nowrap !important; }

    /* Buttons */
    .btn{border-radius:9999px;padding:.6rem 1rem;border:1px solid rgba(0,0,0,.15)}
    .btn-dark{background:var(--ink);color:#fff;border-color:var(--ink)}
    .btn-ghost{border-radius:9999px;padding:.45rem .9rem;border:1px solid rgba(0,0,0,.16); background:rgba(0,0,0,.04)}

    /* Right block */
    .icon-btn{ position:relative; width:38px; height:38px; display:grid; place-items:center; border-radius:9999px; background:rgba(0,0,0,0.06); border:1px solid rgba(0,0,0,0.16); color:var(--ink); }
    .icon-btn:hover{ background:rgba(0,0,0,0.10); }
    .cart-text-btn{ border:1px solid rgba(0,0,0,.16); padding:.45rem .8rem; border-radius:9999px; color:var(--ink); background:rgba(0,0,0,.04); }
    .cart-text-btn:hover{ background:rgba(0,0,0,.08); }
    .badge{ position:absolute; top:-4px; right:-4px; min-width:18px; height:18px; padding:0 4px; display:grid; place-items:center; border-radius:9999px; background:var(--ink); color:#fff; font-size:11px; font-weight:700; border:1px solid rgba(0,0,0,.15); }

    /* Drawers */
    .drawer{position:fixed;inset:0;z-index:60;display:none}
    .drawer.open{display:block}
    #menuDrawer .panel{position:absolute;top:0;left:0;right:auto;width:min(420px,90vw);height:100%;background:#fff;box-shadow:10px 0 30px rgba(0,0,0,.2)}
    #cartDrawer .panel{position:absolute;top:0;right:0;left:auto;width:min(420px,90vw);height:100%;background:#fff;box-shadow:-10px 0 30px rgba(0,0,0,.2)}

    /* Cards + utility */
    .card{ background:#fff; border-radius:16px; border:1px solid rgba(0,0,0,.12); }
    .ring-smooth{ border:1px solid rgba(0,0,0,.12); border-radius:16px; overflow:hidden; }

    /* Hero */
    .hero{ min-height:78vh; display:grid; place-items:center; background:#0f1f27; } /* tumma tausta valkoiselle otsikolle */

    /* Esittelypalkki 3-sarakkeinen */
    .intro-band{ background:#fff; border-radius:var(--band-radius); }
    .intro-grid{ display:grid; grid-template-columns:1fr minmax(0, 760px) 1fr; gap:1rem; align-items:center; }
    .intro-img{ aspect-ratio: 3/4; object-fit:cover; width:100%; border-radius:12px; border:1px solid rgba(0,0,0,.10); }
    @media (max-width: 1024px){
      .intro-grid{ grid-template-columns: 1fr; }
      .intro-side{ order:2; display:grid; grid-template-columns:1fr 1fr; gap:1rem; }
      .intro-text{ order:1; }
    }

    /* Tuote/kaaviot ruudukko */
    .grid-wrap{ position:relative; }
    .product-grid{
      display:grid;
      grid-template-columns: repeat(1, minmax(0,1fr));
      gap:14px;
    }
    @media (min-width:640px){ .product-grid{ grid-template-columns:repeat(2, minmax(0,1fr)); } }
    @media (min-width:1024px){ .product-grid{ grid-template-columns:repeat(4, minmax(0,1fr)); } }
    .prod-card{ position:relative; }
    .square{ aspect-ratio:1/1; background:#fff; border:1px solid rgba(0,0,0,.12); border-radius:12px; overflow:hidden; }
    .square img{ width:100%; height:100%; object-fit:cover; display:block; }
    .caption{ position:absolute; left:8px; right:8px; bottom:8px; font-size:.8rem; font-weight:700; letter-spacing:.06em; text-transform:uppercase; color:#fff;
              text-shadow:0 1px 12px rgba(0,0,0,.55); }
    .collapse{ display:none; align-items:center; justify-content:center; height:100%; }
    .prod-card.selected .thumb{ display:none; }
    .prod-card.selected .collapse{ display:flex; }
    .collapse a{ text-decoration:underline; font-weight:700; }

    /* Expander (iso näkymä rivin alla) */
    .expander{ display:none; }
    .expander.open{ display:block; }
    .expander .big{ aspect-ratio: 4/5; width:100%; object-fit:cover; border-radius:12px; border:1px solid rgba(0,0,0,.12); }
    .nav-btn{ position:absolute; top:50%; transform:translateY(-50%); width:40px; height:40px; display:grid; place-items:center; border-radius:9999px;
              background:rgba(255,255,255,.9); border:1px solid rgba(0,0,0,.2); }
    .nav-btn.left{ left:8px; } .nav-btn.right{ right:8px; }
    .details h3{ color:var(--deep-blue); font-weight:800; }
    .tag{ display:inline-block; border:1px solid rgba(0,0,0,.12); border-radius:9999px; padding:.2rem .6rem; font-size:.8rem; margin-right:.25rem; }

    /* Footer logo mask */
    .logo-mask{ width:36px; height:36px; background:var(--light-blue); -webkit-mask:url('assets/logo.svg') no-repeat center/contain; mask:url('assets/logo.svg') no-repeat center/contain; }
  </style>
</head>
<body>
  <!-- HEADER -->
  <header class="fixed top-0 left-0 right-0 z-50">
    <div id="hdrRow" class="mx-auto max-w-6xl px-4 py-3 grid items-center gap-3">
      <!-- Brand (vasen) -->
      <a id="brandBlock" href="#etusivu" class="flex items-center gap-3">
        <img alt="RUMAT STUDIO logo" class="h-9 w-9 object-contain" src="assets/logo.svg">
        <span id="brandText" class="uppercase text-sm tracking-widest">
          <span class="font-extrabold">RUMAT</span>&nbsp;<span class="font-normal">STUDIO</span>
        </span>
      </a>
      <!-- Nav (keskellä) -->
      <nav id="mainNav">
        <a href="#etusivu" class="hover:underline underline-offset-4 font-semibold">Etusivu</a>
        <a href="#tuotteet" class="hover:underline underline-offset-4 font-semibold">Tuotteet</a>
        <a href="#tarina"   class="hover:underline underline-offset-4 font-semibold">Tarina</a>
        <a href="#blogi"    class="hover:underline underline-offset-4 font-semibold">Blogi</a>
        <a href="#some"     class="hover:underline underline-offset-4 font-semibold">Some</a>
        <a href="#yhteys"   class="hover:underline underline-offset-4 font-semibold">Yhteystiedot</a>
      </nav>
      <!-- Oikea reuna -->
      <div id="rightBlock" class="flex items-center gap-2">
        <!-- ☰ näkyy vasta kun nav ei mahdu -->
        <button id="openMenu" class="icon-btn hidden" aria-controls="menuDrawer" aria-expanded="false" aria-label="Valikko">
          <span aria-hidden="true" style="font-size:20px;line-height:1">☰</span>
          <span class="sr-only">Valikko</span>
        </button>
        <!-- Ostoskori tekstinä (nav mahtuu) -->
        <button id="openCartText" class="cart-text-btn">Ostoskori <span id="cartCountText" class="opacity-80"></span></button>
        <!-- Ostoskori ikonina (nav ei mahdu) -->
        <button id="openCartIcon" class="icon-btn hidden" aria-label="Ostoskori">
          <svg aria-hidden="true" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="9" cy="20" r="1.8"></circle><circle cx="17" cy="20" r="1.8"></circle><path d="M3 4h2l2.2 10.2a2 2 0 0 0 2 1.6h7.7a2 2 0 0 0 2-1.6L21 8H7.1"></path>
          </svg>
          <span class="badge" id="cartCount">0</span>
        </button>
      </div>
    </div>
  </header>

  <main class="pt-[80px]">
    <!-- HERO -->
    <section id="etusivu" class="hero px-4 text-center">
      <h1 class="text-[clamp(28px,5vw,64px)] font-extrabold tracking-[.06em]">Liian rumat ollakseen totta</h1>
      <div class="mt-6 flex justify-center">
        <img src="assets/logo.svg" alt="RUMAT STUDIO" class="h-24 w-24 object-contain">
      </div>
    </section>

    <!-- ESITTELY: kuvat vasen+oikea, keskellä pitkä teksti -->
    <section class="mx-auto max-w-6xl px-4 py-10">
      <div class="intro-band p-5 md:p-8">
        <div class="intro-grid">
          <!-- vasen kuva -->
          <div class="intro-side">
            <img class="intro-img" src="https://images.unsplash.com/photo-1520975922321-6ca0a0a5a0d3?auto=format&fit=crop&w=1200&q=80" alt="Materiaali">
            <img class="intro-img" src="https://images.unsplash.com/photo-1511389026070-a14ae610a1be?auto=format&fit=crop&w=1200&q=80" alt="Luonto">
          </div>
          <!-- teksti -->
          <div class="intro-text text-lg md:text-xl leading-relaxed px-1 md:px-6">
            <p><strong>Luonnosta syntynyt. Reissuissa testattu.</strong> Suunnittelemme kaavoja ja tuotteita,
            jotka kestävät oikeaa elämää: metsäreittejä, kaupunkipäiviä ja kaikkea siltä väliltä. Materiaalit ja
            rakenteet mietitään viimeiseen silmukkaan – jotta istuvuus, hengittävyys ja kestävyys tulevat
            selkäytimestä ilman selittelyä.</p>
            <p class="mt-4">Kaavoista löydät selkeät ohjeet ja kokotaulukot. Voit muokata mittoja omaan kehoon
            sopivaksi ja rakentaa vaatteita, joista tulee omasi – juuri sellaisina kuin elät.</p>
          </div>
          <!-- oikea kuva -->
          <div class="intro-side">
            <img class="intro-img" src="https://images.unsplash.com/photo-1548036328-c9fa89d128fa?auto=format&fit=crop&w=1200&q=80" alt="Kangas">
            <img class="intro-img" src="https://images.unsplash.com/photo-1512436991641-6745cdb1723f?auto=format&fit=crop&w=1200&q=80" alt="Reissu">
          </div>
        </div>
      </div>
    </section>

    <!-- TUOTTEET / KAAVIOT -->
    <section id="tuotteet" class="mx-auto max-w-6xl px-4 py-10">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-3xl font-extrabold">Tuotteet</h2>
        <div class="text-xs opacity-70">Digitaaliset kaavat • Oston jälkeen latauslinkki</div>
      </div>

      <div class="grid-wrap">
        <div id="productGrid" class="product-grid"></div>
        <!-- expander lisätään tähän myöhemmin -->
      </div>
    </section>

    <!-- BLOGI -->
    <section id="blogi" class="mx-auto max-w-6xl px-4 py-10">
      <h2 class="text-3xl font-extrabold mb-6">Blogi</h2>
      <div id="blogRoot" class="grid gap-6">
        <article class="card p-6">
          <h3 class="text-xl mb-2">Matka rumaan kauneuteen</h3>
          <p class="text-[color:#202020]/80">Olen aina etsinyt materiaaleja, jotka kestävät oikeaa elämää: reissujen
            sateet, rinkan hiertämät olkaimet, kaupunkipäivien nopeat käännökset. Kaavat syntyvät testaten, kunnes
            ne toimivat juuri niin kuin pitää.</p>
        </article>
      </div>
    </section>

    <!-- SOME -->
    <section id="some" class="mx-auto max-w-6xl px-4 py-10">
      <h2 class="text-3xl font-extrabold mb-6">Some</h2>
      <div class="grid md:grid-cols-2 gap-6">
        <div class="aspect-[9/16] rounded-xl ring-smooth overflow-hidden bg-black">
          <iframe class="w-full h-full" allowtransparency="true" frameborder="0" scrolling="no" loading="lazy"
                  src="https://www.instagram.com/p/DMXVRgGC1Bv/embed" style="display:block"></iframe>
        </div>
        <div class="aspect-[9/16] rounded-xl ring-smooth overflow-hidden bg-black">
          <iframe
            src="https://www.tiktok.com/embed/v2/7525414518562753814"
            style="width:100%;height:100%;border:0;display:block"
            allow="encrypted-media;"
            allowfullscreen
            title="TikTok video"></iframe>
        </div>
      </div>
    </section>

    <!-- TARINA -->
    <section id="tarina" class="mx-auto max-w-6xl px-4 py-10">
      <h2 class="text-3xl font-extrabold mb-4">Tarina</h2>
      <p>Pienet erät. Kestävä käyttö. Pohjoiset sävyt. Jokainen vaate neulotaan käsin Suomussalmella yhden tekijän
        toimesta — jotta se kestää vuosia ja tekijä näkyy.</p>
    </section>

    <!-- FOOTER -->
    <footer id="yhteys" class="mt-6" style="background:var(--olive); color:var(--ivory);">
      <div class="mx-auto max-w-6xl px-4 py-10 grid sm:grid-cols-3 gap-8">
        <div class="flex items-start gap-3">
          <div class="logo-mask" aria-hidden="true"></div>
          <div>
            <div class="uppercase tracking-wide">RUMAT STUDIO</div>
            <div class="text-sm mt-1 text-white/80">Suomussalmi — Contemporary textiles, built to last.</div>
          </div>
        </div>
        <div>
          <h5 class="text-sm text-white/80">Yhteys</h5>
          <ul class="mt-2 space-y-2 text-sm">
            <li><a href="mailto:hello@rumat.fi" class="hover:underline text-white">hello@rumat.fi</a></li>
            <li><a href="https://instagram.com/rumat.studio" target="_blank" rel="noreferrer" class="hover:underline text-white">Instagram</a></li>
            <li><span class="text-white">Kauppakatu 20, 89600 Suomussalmi</span></li>
          </ul>
        </div>
      </div>
      <div class="py-6 text-center text-xs text-white/80">© <span id="year"></span> RUMAT STUDIO</div>
    </footer>
  </main>

  <!-- OSTOSKORI DRAWER -->
  <div id="cartDrawer" class="drawer" aria-hidden="true">
    <div class="absolute inset-0 bg-black/40" id="closeCart" aria-label="Sulje ostoskori"></div>
    <div class="panel p-5 flex flex-col">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-xl font-semibold">Ostoskori</h3>
        <button id="closeCartX" class="text-stone-500 hover:text-stone-800">✕</button>
      </div>
      <div id="cartItems" class="flex-1 overflow-auto divide-y"></div>
      <div class="mt-4 space-y-3">
        <div class="text-sm grid grid-cols-2 gap-y-1">
          <div class="text-stone-600">Välisumma</div><div class="text-right" id="subTotal">€0,00</div>
        </div>
        <button id="checkout" class="btn btn-dark w-full">Maksa PayPalilla</button>
        <div id="paypalWarn" class="text-xs text-stone-500"></div>
      </div>
    </div>
  </div>

  <!-- VALIKKO DRAWER -->
  <div id="menuDrawer" class="drawer" aria-hidden="true">
    <div class="absolute inset-0 bg-black/40" id="closeMenu" aria-label="Sulje valikko"></div>
    <div class="panel p-6 flex flex-col gap-4">
      <div class="flex items-center justify-between">
        <h3 class="text-xl font-semibold">Valikko</h3>
        <button id="closeMenuX" class="text-stone-500 hover:text-stone-800">✕</button>
      </div>
      <nav class="flex flex-col gap-3 text-lg">
        <a href="#etusivu" class="py-2 border-b" data-menu-close>Etusivu</a>
        <a href="#tuotteet" class="py-2 border-b" data-menu-close>Tuotteet</a>
        <a href="#tarina" class="py-2 border-b" data-menu-close>Tarina</a>
        <a href="#blogi"  class="py-2 border-b" data-menu-close>Blogi</a>
        <a href="#some"   class="py-2 border-b" data-menu-close>Some</a>
        <a href="#yhteys" class="py-2"          data-menu-close>Yhteystiedot</a>
      </nav>
    </div>
  </div>

  <script>
  const fmtEUR = x => new Intl.NumberFormat('fi-FI',{style:'currency',currency:'EUR'}).format(x);
  const $ = s => document.querySelector(s);
  const $$ = s => Array.from(document.querySelectorAll(s));
  const el = (tag,attrs={},...kids)=>{ const n=document.createElement(tag);
    Object.entries(attrs).forEach(([k,v])=>{
      if(k==='class') n.className=v; else if(k==='html') n.innerHTML=v;
      else if(k.startsWith('on')) n.addEventListener(k.slice(2),v); else n.setAttribute(k,v);
    });
    kids.forEach(k=>{ if(k==null) return; if(typeof k==='string') n.appendChild(document.createTextNode(k)); else n.appendChild(k);});
    return n;
  };

  // Vuosi footerissa
  $('#year').textContent = new Date().getFullYear();

  // ---------- Dummy “kaaviot” / tuotteet (8 kpl) ----------
  const PRODUCTS = [
    { id:'laukku', name:'Laukku', price:7.00, sizes:['One size'], blurb:'Sling-tyylinen laukku.', images:[
      'https://images.unsplash.com/photo-1548036328-c9fa89d128fa?auto=format&fit=crop&w=1600&q=80',
      'https://images.unsplash.com/photo-1511389026070-a14ae610a1be?auto=format&fit=crop&w=1600&q=80',
      'https://images.unsplash.com/photo-1520975922321-6ca0a0a5a0d3?auto=format&fit=crop&w=1600&q=80'
    ]},
    { id:'usva', name:'Usva paita', price:8.00, sizes:['XS','S','M','L','XL'], blurb:'Kevyt, hengittävä neule.', images:[
      'https://images.unsplash.com/photo-1519681393784-d120267933ba?auto=format&fit=crop&w=1600&q=80',
      'https://images.unsplash.com/photo-1503341455253-b2e723bb3dbb?auto=format&fit=crop&w=1600&q=80'
    ]},
    { id:'panta', name:'Neule panta', price:4.00, sizes:['S','M','L'], blurb:'Helppo ja lämmin.', images:[
      'https://images.unsplash.com/photo-1512436991641-6745cdb1723f?auto=format&fit=crop&w=1600&q=80'
    ]},
    { id:'kauluri', name:'Kauluri', price:5.00, sizes:['One size'], blurb:'Nopea projekti.', images:[
      'https://images.unsplash.com/photo-1519681393784-d120267933ba?auto=format&fit=crop&w=1600&q=80'
    ]},
    { id:'sukat', name:'Sukat', price:5.00, sizes:['36–38','39–41','42–44'], blurb:'Vahvistettu kanta.', images:[
      'https://images.unsplash.com/photo-1512436991641-6745cdb1723f?auto=format&fit=crop&w=1600&q=80'
    ]},
    { id:'lapaset', name:'Lapaset', price:5.00, sizes:['S','M','L'], blurb:'Peruslapanen.', images:[
      'https://images.unsplash.com/photo-1503341455253-b2e723bb3dbb?auto=format&fit=crop&w=1600&q=80'
    ]},
    { id:'pipo', name:'Pipo', price:4.00, sizes:['One size'], blurb:'Joustinneule.', images:[
      'https://images.unsplash.com/photo-1519681393784-d120267933ba?auto=format&fit=crop&w=1600&q=80'
    ]},
    { id:'villatakki', name:'Villatakki', price:9.00, sizes:['XS','S','M','L','XL'], blurb:'Klassinen raglan.', images:[
      'https://images.unsplash.com/photo-1512436991641-6745cdb1723f?auto=format&fit=crop&w=1600&q=80'
    ]}
  ];

  // ---------- Ostoskori ----------
  let CART = JSON.parse(localStorage.getItem('cart')||'{}');
  function saveCart(){ localStorage.setItem('cart', JSON.stringify(CART)); updateBadge(); }
  function updateBadge(){
    const n = Object.values(CART).reduce((a,b)=>a+b,0);
    const ic = $('#cartCount'); const tx = $('#cartCountText');
    if(ic) ic.textContent = String(n);
    if(tx) tx.textContent = n ? `(${n})` : '';
  }
  const $drawer=$('#cartDrawer');
  function openCart(){ $drawer.classList.add('open'); renderCart(); }
  function closeCart(){ $drawer.classList.remove('open'); }
  $('#openCartText')?.addEventListener('click', openCart);
  $('#openCartIcon')?.addEventListener('click', openCart);
  $('#closeCart')?.addEventListener('click', closeCart);
  $('#closeCartX')?.addEventListener('click', closeCart);

  function renderCart(){
    const root = $('#cartItems'); root.innerHTML='';
    let sub=0;
    Object.entries(CART).forEach(([id,q])=>{
      const p = PRODUCTS.find(x=>x.id===id); if(!p) return;
      sub += p.price*q;
      root.appendChild(el('div',{class:'py-3 flex items-center justify-between'},
        el('div',{},
          el('div',{class:'font-medium'}, p.name),
          el('div',{class:'text-sm text-[color:#202020]/70'}, fmtEUR(p.price))
        ),
        el('button',{'data-remove':id, class:'px-2 ring-1 ring-[rgba(0,0,0,.15)] rounded'}, 'Poista')
      ));
    });
    $('#subTotal').textContent = fmtEUR(sub);
    root.querySelectorAll('[data-remove]').forEach(b=>b.onclick=()=>{ const id=b.dataset.remove; delete CART[id]; saveCart(); renderCart(); });
  }
  function addToCart(id){ CART[id]=(CART[id]||0)+1; saveCart(); openCart(); }
  updateBadge();

  $('#checkout')?.addEventListener('click', ()=>{
    const ids = Object.keys(CART);
    if(ids.length===0) return alert('Lisää tuotteita koriin.');
    alert('Demo: lisää PayPal-integraatio julkaisuun.');
  });

  // ---------- Tuoteruudukko + expander ----------
  const grid = $('#productGrid');
  let selectedId = null;
  let selectedIdx = -1;

  // Luo kortit
  PRODUCTS.forEach((p,idx)=>{
    const card = el('button',{class:'prod-card text-left', 'data-id':p.id, 'data-idx':idx});
    const square = el('div',{class:'square'});
    const thumb = el('div',{class:'thumb relative h-full w-full'});
    thumb.appendChild(el('img',{src:p.images[0], alt:p.name}));
    thumb.appendChild(el('div',{class:'caption'}, p.name.toUpperCase()));
    const collapse = el('div',{class:'collapse'},
      el('a',{'data-collapse':p.id, href:'#tuotteet'}, 'Pienennä')
    );
    square.appendChild(thumb);
    square.appendChild(collapse);
    card.appendChild(square);
    grid.appendChild(card);
  });

  // Expander elementti
  const expander = el('div',{id:'kaavioExpander', class:'expander card p-4 md:p-6 mt-3'});
  expander.innerHTML = `
    <div class="grid md:grid-cols-5 gap-4 md:gap-6 items-start">
      <div class="relative md:col-span-3">
        <img id="expImg" class="big" alt="">
        <button class="nav-btn left" id="prevImg" aria-label="Edellinen">◀</button>
        <button class="nav-btn right" id="nextImg" aria-label="Seuraava">▶</button>
      </div>
      <div class="details md:col-span-2">
        <h3 id="expName" class="text-2xl mb-2"></h3>
        <div id="expPrice" class="text-lg font-semibold mb-2"></div>
        <div id="expSizes" class="mb-3"></div>
        <p id="expBlurb" class="text-[color:#202020]/80 mb-4"></p>
        <button id="expBuy" class="btn btn-dark">Osta</button>
      </div>
    </div>
  `;
  let imgIdx = 0;

  function getCols(){
    const style = getComputedStyle(grid);
    const cols = style.gridTemplateColumns.split(' ').length;
    return Math.max(1, cols||1);
  }
  function placeExpander(idx){
    const cols = getCols();
    const rowStart = Math.floor(idx/cols)*cols;
    const rowEnd = Math.min(rowStart + cols - 1, PRODUCTS.length - 1);
    const afterEl = grid.querySelector(`.prod-card[data-idx="${rowEnd}"]`);
    if(!afterEl) return;
    afterEl.after(expander);
  }
  function openProduct(id, idx){
    const p = PRODUCTS.find(x=>x.id===id); if(!p) return;
    selectedId = id; selectedIdx = idx;
    // Päivitä expanderin sisältö
    imgIdx = 0;
    $('#expImg').src = p.images[imgIdx];
    $('#expImg').alt = p.name;
    $('#expName').textContent = p.name;
    $('#expPrice').textContent = fmtEUR(p.price);
    const sizesWrap = $('#expSizes'); sizesWrap.innerHTML='';
    (p.sizes||[]).forEach(s=>sizesWrap.appendChild(el('span',{class:'tag'}, s)));
    $('#expBlurb').textContent = p.blurb||'';
    $('#expBuy').onclick = ()=>addToCart(p.id);

    // Merkitse valituksi (Pienennä näkyviin)
    $$('.prod-card').forEach(c=>c.classList.remove('selected'));
    const card = grid.querySelector(`.prod-card[data-id="${id}"]`);
    if(card) card.classList.add('selected');

    placeExpander(idx);
    expander.classList.add('open');
    // Nuolikuuntelijat
    $('#prevImg').onclick = ()=>{ imgIdx=(imgIdx-1+p.images.length)%p.images.length; $('#expImg').src=p.images[imgIdx]; };
    $('#nextImg').onclick = ()=>{ imgIdx=(imgIdx+1)%p.images.length; $('#expImg').src=p.images[imgIdx]; };
  }
  function closeProduct(){
    selectedId = null; selectedIdx = -1;
    expander.classList.remove('open');
    $$('.prod-card').forEach(c=>c.classList.remove('selected'));
  }

  // Klikkaukset ruudukossa
  grid.addEventListener('click', e=>{
    const collapse = e.target.closest('[data-collapse]');
    if(collapse){ e.preventDefault(); closeProduct(); return; }
    const card = e.target.closest('.prod-card'); if(!card) return;
    const id = card.getAttribute('data-id');
    const idx = Number(card.getAttribute('data-idx'));
    if(selectedId === id){ /* jo auki -> pienennä */ closeProduct(); return; }
    openProduct(id, idx);
  });

  // Reposiointi kun ikkuna muuttuu
  window.addEventListener('resize', ()=>{
    if(selectedId!=null && selectedIdx>=0){ placeExpander(selectedIdx); }
  }, {passive:true});

  // ---------- Valikko drawer ----------
  (function(){
    const drawer = document.getElementById('menuDrawer');
    const openBtn = document.getElementById('openMenu');
    const closeA = document.getElementById('closeMenu');
    const closeX = document.getElementById('closeMenuX');
    const close = ()=>{ drawer.classList.remove('open'); openBtn.setAttribute('aria-expanded','false'); };
    const open  = ()=>{ drawer.classList.add('open'); openBtn.setAttribute('aria-expanded','true'); };
    openBtn.addEventListener('click', open);
    closeA.addEventListener('click', close);
    closeX.addEventListener('click', close);
    drawer.addEventListener('click', e=>{ if(e.target===drawer) close(); });
    document.addEventListener('keydown', e=>{ if(e.key==='Escape') close(); });
    drawer.querySelectorAll('[data-menu-close]').forEach(a=>a.addEventListener('click', close));
  })();

  // ---------- Responsive nav: näytä ☰ + cart-IKONI jos nav ei mahdu ----------
  (function(){
    const container = document.getElementById('hdrRow');
    const brand     = document.getElementById('brandBlock');
    const nav       = document.getElementById('mainNav');
    const right     = document.getElementById('rightBlock');
    const menuBtn   = document.getElementById('openMenu');
    const cartIcon  = document.getElementById('openCartIcon');
    const cartText  = document.getElementById('openCartText');

    let navVisible = true;

    function measureNavWidth(){
      const wasHidden = nav.classList.contains('nav-hidden');
      if (wasHidden) nav.classList.remove('nav-hidden');
      nav.classList.add('nav-measure');
      const w = Math.ceil(nav.scrollWidth);
      nav.classList.remove('nav-measure');
      if (wasHidden) nav.classList.add('nav-hidden');
      return w;
    }

    function canShowNav(){
      const prevMenuHidden = menuBtn.classList.contains('hidden');
      const prevCartIconHidden = cartIcon.classList.contains('hidden');
      const prevCartTextHidden = cartText.classList.contains('hidden');

      menuBtn.classList.add('hidden');
      cartIcon.classList.add('hidden');
      cartText.classList.remove('hidden');

      const cw   = container.clientWidth;
      const bw   = Math.ceil(brand.getBoundingClientRect().width);
      const rbw  = Math.ceil(right.getBoundingClientRect().width);
      const navW = measureNavWidth();
      const fits = navW <= Math.max(0, cw - bw - rbw - 24);

      if (!prevMenuHidden) menuBtn.classList.remove('hidden');
      if (!prevCartIconHidden) cartIcon.classList.remove('hidden'); else cartIcon.classList.add('hidden');
      if ( prevCartTextHidden) cartText.classList.add('hidden'); else cartText.classList.remove('hidden');

      return fits;
    }

    function applyState(showNav){
      navVisible = !!showNav;
      if (navVisible){
        nav.classList.remove('nav-hidden');
        menuBtn.classList.add('hidden');
        cartIcon.classList.add('hidden');
        cartText.classList.remove('hidden');
      }else{
        nav.classList.add('nav-hidden');
        menuBtn.classList.remove('hidden');
        cartIcon.classList.remove('hidden');
        cartText.classList.add('hidden');
      }
    }

    function compute(){ if (navVisible){ if (!canShowNav()) applyState(false); } else { if (canShowNav()) applyState(true); } }
    let t=null; const schedule=()=>{ if(t) return; t=setTimeout(()=>{ t=null; compute(); }, 120); };
    window.addEventListener('resize', schedule, {passive:true});
    if ('fonts' in document) document.fonts.ready.then(compute);
    compute();
  })();
  </script>
</body>
</html>
