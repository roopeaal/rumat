<script>
  // VAIHDA oma Worker-osoitteesi
  const API_BASE = "https://rumat-backend.<tilisi>.workers.dev";

  (async () => {
    try {
      const r = await fetch(`${API_BASE}/api/content`, { credentials:"include" });
      if (!r.ok) return; // jos ei vielä käytössä, poistutaan hiljaa
      const data = await r.json();

      // 1) Hero
      if (data?.hero?.headline) {
        const h = document.getElementById('hero-text')?.querySelector('h1');
        if (h) h.textContent = data.hero.headline;
      }
      if (data?.hero?.image) {
        const bg = document.querySelector('.hero-fixed img');
        if (bg) bg.src = data.hero.image;
      }

      // 2) PayPal business -sähköposti kaikkiin osto-nappeihin
      if (data?.paypalBusiness) {
        document.querySelectorAll('input[name="business"]').forEach(inp => {
          inp.value = data.paypalBusiness;
        });
      }

      // 3) Tuotekuvat – korvaa taulukot ja päivitä näkyvät
      if (Array.isArray(data?.products)) {
        const byId = Object.fromEntries(data.products.map(p => [p.id, p]));
        // Laukku
        if (byId.laukku?.images?.length) {
          window.slingImgs = byId.laukku.images.slice();
          // Nollaa ja näytä pari
          window.i1 = 0;
          const setWithFallback = (imgEl, url)=>{
            if(!imgEl) return;
            imgEl.onerror = ()=>{ imgEl.onerror=null; imgEl.src = "https://placehold.co/1400x1750?text=Kuva"; };
            imgEl.src = url;
          };
          const a = document.getElementById('p1a'), b = document.getElementById('p1b');
          setWithFallback(a, window.slingImgs[0]);
          setWithFallback(b, window.slingImgs[1 % window.slingImgs.length]);
        }
        // Pipo
        if (byId.pipo?.images?.length) {
          window.pipoImgs = byId.pipo.images.slice();
          window.i2 = 0;
          const setWithFallback = (imgEl, url)=>{
            if(!imgEl) return;
            imgEl.onerror = ()=>{ imgEl.onerror=null; imgEl.src = "https://placehold.co/1400x1750?text=Kuva"; };
            imgEl.src = url;
          };
          const a = document.getElementById('p2a'), b = document.getElementById('p2b');
          setWithFallback(a, window.pipoImgs[0]);
          setWithFallback(b, window.pipoImgs[1 % window.pipoImgs.length]);
        }

        // Hintoja/tekstejä voi myös korvata, jos haluat (esim. data.products[].price)
        // Voit antaa tuotteelle id:t ja hakea vastaavat <h3>/<div> jne. myöhemmin.
      }

    } catch(e) {
      // Ei pakollinen; jos backend ei käytössä, sivu toimii staattisena
      console.warn("Sisältöä ei luettu backendistä:", e);
    }
  })();
</script>
