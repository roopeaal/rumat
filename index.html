<!doctype html>
<html lang="fi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>RUMAT.STUDIO</title>
  <meta name="description" content="Luonnosta syntynyt. Reissuissa testattu. Neuleet ja asusteet poluille ja kaupunkiin – istuvat, hengittävät ja kestävät."/>

  <!-- Fontit + Tailwind -->
  <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;600;700&family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- OG -->
  <meta property="og:title" content="RUMAT.STUDIO – Luonnosta syntynyt. Reissuissa testattu.">
  <meta property="og:description" content="Neuleet ja asusteet poluille ja kaupunkiin – istuvat, hengittävät ja kestävät.">
  <meta property="og:type" content="website">
  <meta property="og:image" content="https://placehold.co/1200x630?text=RUMAT.STUDIO">
  <meta name="twitter:card" content="summary_large_image">

  <style>
    :root{
      --ink:#202020;
      --dark-forest:#0B0F0E;     /* header tausta */
      --olive:#A1A266;
      --ivory:#F6F6F4;
      --mist:#DEEEEE;            /* esittelypalkkien tausta */
      --gallery:#F6F6F4;         /* kuvapalkkien tausta */
      --footer:#0B0F0E;
      --silhouette:#08110d;
      --silhouette-mid:#0c1a15;
      --silhouette-line:#9fb1a9;
      --window-warm:#FFD780;
    }
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial;color:#111827;background:#fff}
    .serif{font-family:"Libre Baskerville",serif}
    .shadow-soft{box-shadow:0 6px 20px rgba(0,0,0,.12)}
    .btn{border-radius:9999px;padding:.6rem 1rem;border:1px solid rgb(214,211,209);transition:transform .06s, box-shadow .12s}
    .btn:hover{transform:translateY(-1px);box-shadow:0 6px 18px rgba(0,0,0,.12)}
    .btn-dark{background:#111827;color:#fff;border-color:#111827}
    .chip{font-size:.78rem;padding:.25rem .55rem;border-radius:9999px;border:1px solid rgb(214,211,209);background:#fff}

    /* Aurora (kiinteä tausta) */
    .aurora-fixed{ position:fixed; inset:0; width:100%; height:100%; z-index:0; pointer-events:none; display:block; }
    .site-content{ position:relative; z-index:2; background:transparent; }

    /* Hero */
    .hero{ position:relative; height:100vh; isolation:isolate; overflow:hidden; }
    .hero-overlay{ position:absolute; inset:0; z-index:1; pointer-events:none;
      background: radial-gradient(58% 42% at 50% 18%, rgba(255,255,255,.06), transparent 55%),
                  linear-gradient(to bottom, rgba(0,0,0,.16), rgba(0,0,0,.36) 72%); }
    #hero-text{ position:relative; z-index:2; }

    /* Alareunan siluetti */
    .bottom-sil{ position:fixed; left:0; right:0; bottom:-1px; height:160px; z-index:1; pointer-events:none;
      mask-image: linear-gradient(to top, black 72%, transparent 100%);
      -webkit-mask-image: linear-gradient(to top, black 72%, transparent 100%);}
    .bottom-sil svg{ width:100%; height:100%; display:block; }
    .smoke{ animation:smoke 6s ease-in-out infinite; transform-origin:center; opacity:.6 }
    .smoke.s2{ animation-delay:1.4s }
    @keyframes smoke{ 0%{transform:translateY(0) scale(1);opacity:.6} 100%{transform:translateY(-28px) scale(1.4);opacity:0} }

    /* Drawer & Modal */
    .drawer{position:fixed;inset:0;z-index:60;display:none}
    .drawer.open{display:block}
    .drawer .panel{position:absolute;top:0;right:0;width:min(420px,90vw);height:100%;background:#fff;box-shadow:-10px 0 30px rgba(0,0,0,.2)}
    .modal{position:fixed;inset:0;z-index:70;display:none}
    .modal.open{display:grid;place-items:center}
  </style>
</head>

<body class="text-stone-900">
  <!-- KIINTEÄ REVONTULI-TAUSTA -->
  <canvas id="auroraCanvas" class="aurora-fixed"></canvas>

  <!-- ALAREUNAN SILUETTI (kuuset pienemmät, mökki näkyvä) -->
  <div class="bottom-sil" aria-hidden="true">
    <svg viewBox="0 0 1440 160" preserveAspectRatio="none">
      <defs>
        <filter id="windowGlow" x="-50%" y="-50%" width="200%" height="200%"><feGaussianBlur in="SourceGraphic" stdDeviation="2" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
        <!-- Peruspuidut -->
        <g id="treeTall" fill="var(--silhouette)">
          <path d="M0,0 l-18,22 h36 z" transform="translate(0,0)"/>
          <path d="M0,0 l-20,24 h40 z" transform="translate(0,10)"/>
          <path d="M0,0 l-22,26 h44 z" transform="translate(0,22)"/>
          <path d="M0,0 l-24,28 h48 z" transform="translate(0,36)"/>
          <rect x="-3.2" y="60" width="6.4" height="12" rx="1"/>
        </g>
        <g id="treeMed" fill="var(--silhouette)">
          <path d="M0,0 l-14,18 h28 z" transform="translate(0,2)"/>
          <path d="M0,0 l-16,20 h32 z" transform="translate(0,12)"/>
          <path d="M0,0 l-18,22 h36 z" transform="translate(0,24)"/>
          <rect x="-2.8" y="48" width="5.6" height="10" rx="1"/>
        </g>
        <g id="treeSmall" fill="var(--silhouette)">
          <path d="M0,0 l-11,14 h22 z" transform="translate(0,4)"/>
          <path d="M0,0 l-13,16 h26 z" transform="translate(0,12)"/>
          <rect x="-2.4" y="40" width="4.8" height="8" rx="1"/>
        </g>
      </defs>

      <!-- Vuoriharjanteet -->
      <path d="M0,120 C180,105 240,108 340,114 C460,121 520,110 640,116 C760,122 880,108 1000,114 C1160,122 1280,110 1440,118 L1440,160 L0,160 Z" fill="var(--silhouette-mid)" opacity=".28"/>
      <path d="M0,122 C120,118 190,110 260,118 C340,126 420,106 500,116 C580,126 670,108 760,120 C850,132 980,110 1100,118 C1220,126 1330,112 1440,120 L1440,160 L0,160 Z" fill="var(--silhouette-mid)" opacity=".44"/>
      <path d="M0,130 C160,128 320,132 480,130 C640,128 800,131 960,129 C1120,128 1280,131 1440,129 L1440,160 L0,160 Z" fill="var(--silhouette)"/>

      <!-- Kuuset (skaala ~0.75, tyhjä vyöhyke mökin edessä 1180–1275) -->
      <g>
        <use href="#treeTall"  transform="translate(55,76) scale(0.75)"/>
        <use href="#treeMed"   transform="translate(95,82) scale(0.75)"/>
        <use href="#treeSmall" transform="translate(128,88) scale(0.75)"/>
        <use href="#treeTall"  transform="translate(168,74) scale(0.75)"/>
        <use href="#treeMed"   transform="translate(210,82) scale(0.75)"/>

        <use href="#treeTall"  transform="translate(520,74) scale(0.75)"/>
        <use href="#treeMed"   transform="translate(558,82) scale(0.75)"/>
        <use href="#treeSmall" transform="translate(592,88) scale(0.75)"/>
        <use href="#treeTall"  transform="translate(632,72) scale(0.75)"/>
        <use href="#treeMed"   transform="translate(674,82) scale(0.75)"/>
        <use href="#treeSmall" transform="translate(706,90) scale(0.75)"/>
        <use href="#treeTall"  transform="translate(748,74) scale(0.75)"/>
        <use href="#treeMed"   transform="translate(786,82) scale(0.75)"/>

        <use href="#treeTall"  transform="translate(1086,76) scale(0.75)"/>
        <use href="#treeMed"   transform="translate(1122,84) scale(0.75)"/>
        <use href="#treeSmall" transform="translate(1156,90) scale(0.75)"/>

        <!-- tyhjä mökille -->

        <use href="#treeMed"   transform="translate(1300,84) scale(0.75)"/>
        <use href="#treeSmall" transform="translate(1340,90) scale(0.75)"/>
        <use href="#treeTall"  transform="translate(1380,76) scale(0.75)"/>
      </g>

      <!-- Mökki (nostettu ja ilman ääriviivoja) -->
      <g>
        <!-- talo + katto -->
        <rect x="1203" y="115" width="44" height="22" rx="1" fill="var(--silhouette)"/>
        <path d="M1198,116 L1225,100 L1252,116 Z" fill="var(--silhouette)"/>
        <!-- piippu -->
        <rect x="1232" y="102" width="6" height="12" fill="var(--silhouette)"/>
        <!-- lämmin ikkuna -->
        <rect x="1226" y="110" width="14" height="11" rx="1.5"
              fill="var(--window-warm)" opacity=".9" filter="url(#windowGlow)"/>
      </g>

      <!-- Savu (siirretty ylemmäs) -->
      <g fill="#b7c7c1">
        <circle class="smoke"  cx="1235" cy="98" r="2.8"/>
        <circle class="smoke s2" cx="1239" cy="93" r="2.2"/>
      </g>
    </svg>
  </div>

  <!-- HEADER -->
  <header class="fixed top-0 left-0 right-0 z-50">
    <div class="relative bg-[color:var(--dark-forest)] text-white">
      <div class="mx-auto max-w-6xl px-4 py-3 grid grid-cols-[1fr_auto_1fr] items-center gap-3">
        <a href="#etusivu" class="flex items-center gap-3">
          <div class="h-9 w-9 grid place-items-center rounded-xl ring-1 ring-white/40 bg-white/90">
            <span class="-rotate-90 serif text-2xl font-black text-stone-900">R</span>
          </div>
          <span class="hidden sm:block text-sm uppercase tracking-widest font-semibold">RUMAT.STUDIO</span>
        </a>
        <nav class="justify-self-center hidden md:flex items-center gap-6 text-[13px] uppercase tracking-widest">
          <a href="#etusivu"   class="hover:underline underline-offset-4 font-semibold">Etusivu</a>
          <a href="#tuotteet"  class="hover:underline underline-offset-4 font-semibold">Tuotteet</a>
          <a href="#tarina"    class="hover:underline underline-offset-4 font-semibold">Tarina</a>
          <a href="#blogi"     class="hover:underline underline-offset-4 font-semibold">Blogi</a>
          <a href="#some"      class="hover:underline underline-offset-4 font-semibold">Some</a>
          <a href="#yhteys"    class="hover:underline underline-offset-4 font-semibold">Yhteystiedot</a>
        </nav>
        <div class="justify-self-end flex items-center gap-2">
          <button id="openCart" class="px-3 py-2 rounded-full bg-white/10 ring-1 ring-white/30 hover:bg-white/20">
            Ostoskori (<span id="cartCount">0</span>)
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- SISÄLTÖ -->
  <main class="site-content">
    <!-- HERO -->
    <section id="etusivu" class="hero grid place-items-center text-stone-50 px-4">
      <div class="hero-overlay"></div>
      <div id="hero-text" class="text-center transition-transform mt-24 md:mt-28">
        <h1 class="serif font-semibold tracking-[0.08em] text-[clamp(22px,4.8vw,58px)]
                   drop-shadow-[0_2px_16px_rgba(0,0,0,0.40)]">
          Liian rumat ollakseen totta
        </h1>
        <div class="mt-8 flex justify-center">
          <div class="h-24 w-24 sm:h-28 sm:w-28 grid place-items-center rounded-full bg-white/92 ring-1 ring-white/70 shadow-soft">
            <span class="-rotate-90 serif text-5xl sm:text-6xl font-black text-stone-900">R</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Esittely -->
    <section class="py-12 bg-white">
      <div class="mx-auto max-w-3xl px-6 text-center">
        <p id="intro-text" class="text-xl sm:text-2xl">
          <strong>Luonnosta syntynyt. Reissuissa testattu.</strong>
          Suunnittelemani neuleet ja asusteet kulkevat mukana poluilla ja kaupungissa – jotta sinulla on päälläsi jotain, joka istuu, hengittää ja kestää jokaisella askeleella.
        </p>
      </div>
    </section>

    <!-- TUOTTEET -->
    <section id="tuotteet" class="py-14 bg-white">
      <div class="mx-auto max-w-6xl px-4">
        <div class="flex items-center justify-between mb-6">
          <h2 class="serif text-3xl">Tuotteet</h2>
          <div class="text-xs text-stone-500">Hinnat sis. ALV • Palautus 14 vrk • Toimitus valitaan kassalla</div>
        </div>
        <div id="productsRoot" class="space-y-14"></div>
      </div>
    </section>

    <!-- BLOGI -->
    <section id="blogi" class="py-14" style="background:var(--mist)">
      <div class="mx-auto max-w-4xl px-6">
        <h2 class="serif text-3xl mb-6">Blogi</h2>
        <div id="blogRoot" class="grid gap-6"></div>
      </div>
    </section>

    <!-- SOME -->
    <section id="some" class="py-14 bg-white">
      <div class="mx-auto max-w-6xl px-4">
        <h2 class="serif text-3xl mb-6">Some</h2>
        <div class="grid md:grid-cols-2 gap-6">
          <div class="aspect-[9/16] rounded-xl ring-1 ring-stone-200 overflow-hidden bg-black">
            <iframe id="igEmbed" class="w-full h-full" allowtransparency="true" frameborder="0" scrolling="no" loading="lazy"
                    src="https://www.instagram.com/p/DMXVRgGC1Bv/embed" style="display:block"></iframe>
          </div>
          <div class="aspect-[9/16] rounded-xl ring-1 ring-stone-200 overflow-hidden bg-black">
            <iframe id="ttEmbed"
              src="https://www.tiktok.com/embed/v2/7525414518562753814"
              style="width:100%;height:100%;border:0;display:block"
              allow="encrypted-media;"
              allowfullscreen
              title="TikTok video"></iframe>
          </div>
        </div>
      </div>
    </section>

    <!-- TARINA -->
    <section id="tarina" class="py-14 bg-stone-50">
      <div class="mx-auto max-w-3xl px-6">
        <h2 class="serif text-3xl mb-4">Tarina</h2>
        <p id="story">
          Pienet erät. Kestävä käyttö. Pohjoiset sävyt. Valmistamme pieniä eriä Suomessa ja EU:ssa, jotta vaate kestää vuosia ja tekijät näkyvät.
        </p>
      </div>
    </section>

    <!-- FOOTER -->
    <footer id="yhteys" class="pt-14 text-[color:var(--ivory)]" style="background:var(--footer)">
      <div class="mx-auto max-w-6xl px-4 grid sm:grid-cols-3 gap-8">
        <div>
          <div class="uppercase tracking-wide">RUMAT.STUDIO</div>
          <div id="tagline" class="text-sm mt-1 text-white/70">Helsinki — Contemporary textiles, built to last.</div>
        </div>
        <div>
          <h5 class="text-sm text-white/70">Yhteys</h5>
          <ul class="mt-2 space-y-2 text-sm">
            <li><a id="mailLink" href="mailto:hello@rumat.fi" class="hover:underline">hello@rumat.fi</a></li>
            <li><a id="igLink" href="https://instagram.com/rumat.studio" target="_blank" rel="noreferrer" class="hover:underline">Instagram</a></li>
            <li><a id="ttLink" href="https://www.tiktok.com/@rumat.studio" target="_blank" rel="noreferrer" class="hover:underline">TikTok</a></li>
            <li id="location">Rovaniemi — Helsinki</li>
          </ul>
        </div>
        <div>
          <h5 class="text-sm text-white/70">Toimitus</h5>
          <ul class="mt-2 space-y-2 text-sm" id="shipInfo">
            <li>Toimitus valitaan kassalla</li>
            <li>Nouto (sovitusti) — 0 €</li>
            <li>Posti — 6,90 €</li>
          </ul>
        </div>
      </div>
      <div class="py-8 text-center text-xs text-white/65">© <span id="year"></span> RUMAT.STUDIO</div>
    </footer>
  </main>

  <!-- OSTOSKORI -->
  <div id="cartDrawer" class="drawer">
    <div class="absolute inset-0 bg-black/40" id="closeCart"></div>
    <div class="panel p-5 flex flex-col">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-xl font-semibold">Ostoskori</h3>
        <button id="closeCartX" class="text-stone-500 hover:text-stone-800">✕</button>
      </div>
      <div id="cartItems" class="flex-1 overflow-auto divide-y"></div>
      <div class="mt-4 space-y-3">
        <div>
          <div class="text-sm font-medium mb-1">Toimitus</div>
          <div id="shipOptions" class="space-y-1"></div>
        </div>
        <div class="text-sm grid grid-cols-2 gap-y-1">
          <div class="text-stone-600">Välisumma</div><div class="text-right" id="subTotal">€0,00</div>
          <div class="text-stone-600">Toimitus</div><div class="text-right" id="shipTotal">€0,00</div>
          <div class="font-semibold">Yhteensä</div><div class="text-right font-semibold" id="grandTotal">€0,00</div>
        </div>
        <button id="checkout" class="btn btn-dark w-full">Maksa PayPalilla</button>
        <div id="paypalWarn" class="text-xs text-stone-500"></div>
      </div>
    </div>
  </div>

  <!-- SUCCESS/CANCEL MODAL -->
  <div id="resultModal" class="modal">
    <div class="bg-white rounded-2xl p-6 shadow-soft w-[min(92vw,480px)] text-center">
      <h3 id="resultTitle" class="serif text-2xl mb-2">Kiitos tilauksesta!</h3>
      <p id="resultText" class="text-stone-600">Vahvistus saapuu sähköpostiisi.</p>
      <a href="#" class="btn btn-dark mt-4 inline-block">Takaisin etusivulle</a>
    </div>
  </div>

  <!-- SCRIPTS -->
  <script>
  const API_BASE = ""; // esim. "https://rumat-backend.<tunnus>.workers.dev"
  const fmtEUR = x => new Intl.NumberFormat('fi-FI',{style:'currency',currency:'EUR'}).format(x);
  const $ = sel => document.querySelector(sel);
  const el = (tag,attrs={},...kids)=>{ const n=document.createElement(tag); Object.entries(attrs).forEach(([k,v])=>{
      if(k==='class') n.className=v; else if(k==='html') n.innerHTML=v; else if(k.startsWith('on')) n.addEventListener(k.slice(2),v);
      else n.setAttribute(k,v);
    }); kids.forEach(k=>{ if(k==null) return; if(typeof k==='string') n.appendChild(document.createTextNode(k)); else n.appendChild(k);}); return n;};

  // Hero-tekstin liike (vain teksti nousee)
  (function(){
    const hero=document.getElementById('etusivu'); const textEl=document.getElementById('hero-text'); const yearEl=document.getElementById('year');
    yearEl.textContent = new Date().getFullYear();
    function onScroll(){ const r=hero.getBoundingClientRect(); const h=Math.max(1,r.height); const p=Math.min(1,Math.max(0,-r.top/h)); const ty=-18*Math.min(1,p/0.9); textEl.style.transform=`translateY(${ty}vh)`; }
    addEventListener('scroll', onScroll, {passive:true}); addEventListener('resize', onScroll, {passive:true}); onScroll();
  })();

  // ----- CMS / sisältö (paikallinen oletus, voi hakea backendistä) -----
  const defaultContent = {
    hero:{ headline:"Liian rumat ollakseen totta" },
    paypalBusiness:"",
    contact:{
      email:"hello@rumat.fi",
      instagram:"https://instagram.com/rumat.studio",
      tiktok:"https://www.tiktok.com/@rumat.studio",
      location:"Rovaniemi — Helsinki"
    },
    embed:{ instagramPost:"https://www.instagram.com/p/DMXVRgGC1Bv/embed", tiktokVideo:"https://www.tiktok.com/@rumat.studio/video/7525414518562753814" },
    pitch:"Luonnosta syntynyt. Reissuissa testattu. Suunnittelemani neuleet ja asusteet kulkevat mukana poluilla ja kaupungissa – jotta sinulla on päälläsi jotain, joka istuu, hengittää ja kestää jokaisella askeleella.",
    products:[
      { id:"laukku", name:"Laukku", price:149.00, blurb:"Täysin kierrätysmateriaaleista valmistettu sling-laukku. Kierrätetty purjekangas/tekstiili, hihna käytetystä turvavyöstä, metalliosat uudelleenkäytettyä varastoa. Ulkomitat: 28 × 16 × 7 cm. Valmistettu Suomessa.", images:[
        "https://images.unsplash.com/photo-1548036328-c9fa89d128fa?auto=format&fit=crop&w=1600&q=80",
        "https://images.unsplash.com/photo-1520975922321-6ca0a0a5a0d3?auto=format&fit=crop&w=1600&q=80",
        "https://images.unsplash.com/photo-1511389026070-a14ae610a1be?auto=format&fit=crop&w=1600&q=80"
      ]},
      { id:"pipo", name:"RUMAT Pipo", price:59.00, blurb:"Käsinneulottu mohair-sekoite. Korkeus n. 22 cm. Päänympärys 54–58 cm (joustava).", images:[
        "https://images.unsplash.com/photo-1519681393784-d120267933ba?auto=format&fit=crop&w=1600&q=80",
        "https://images.unsplash.com/photo-1512436991641-6745cdb1723f?auto=format&fit=crop&w=1600&q=80",
        "https://images.unsplash.com/photo-1503341455253-b2e723bb3dbb?auto=format&fit=crop&w=1600&q=80"
      ]}
    ],
    payment:{ shipping:{ methods:[
      { id:"PICKUP", name:"Nouto (sovitusti)", price:"€0,00" },
      { id:"POSTI",  name:"Posti",             price:"€6,90" }
    ], defaultMethodId:"PICKUP" } },
    blog:[{ title:"Matka rumaan kauneuteen", body:"Olen aina etsinyt materiaaleja, jotka kestävät oikeaa elämää: reissujen sateet, rinkan hiertämät olkaimet, kaupunkipäivien nopeat käännökset. RUMAT syntyi siitä, että vaatteiden pitää tehdä työnsä — hengittää, istua ja kestää — ilman turhaa selittelyä. Kaikki mallini syntyvät metsässä ja kaupungissa testaten, kunnes ne toimivat juuri niin kuin pitää." }]
  };

  let CONTENT = structuredClone(defaultContent);

  async function loadContent(){
    if(!API_BASE){ applyContent(CONTENT); return; }
    try{
      const r = await fetch(`${API_BASE}/api/content`, {credentials:'include'});
      if(r.ok){ const d = await r.json(); CONTENT = Object.assign({}, CONTENT, d); }
    }catch(e){ console.warn("Sisällön haku epäonnistui", e); }
    applyContent(CONTENT);
  }

  function priceNum(s){ if(typeof s==='number') return s; const m=String(s||"").replace(/\s/g,"").match(/([0-9]+(?:[.,][0-9]{1,2})?)/); return m?parseFloat(m[1].replace(',','.')):0; }
  function parseTikTokId(url){ const m=String(url||"").match(/video\/(\d+)/); return m?m[1]:null; }

  function applyContent(d){
    if(d?.hero?.headline) document.querySelector('#hero-text h1').textContent = d.hero.headline;
    if(d?.pitch) document.getElementById('intro-text').textContent = d.pitch;
    if(d?.story) document.getElementById('story').textContent = d.story;

    if(d?.contact?.email){ const ml=$('#mailLink'); ml.href=`mailto:${d.contact.email}`; ml.textContent=d.contact.email; }
    if(d?.contact?.instagram){ const ig=$('#igLink'); ig.href=d.contact.instagram; }
    if(d?.contact?.tiktok){ const tt=$('#ttLink'); if(tt) tt.href=d.contact.tiktok; }
    if(d?.contact?.location){ $('#location').textContent = d.contact.location; }

    if(d?.embed?.instagramPost) $('#igEmbed').src = d.embed.instagramPost;
    if(d?.embed?.tiktokVideo){ const id=parseTikTokId(d.embed.tiktokVideo); if(id){ $('#ttEmbed').src=`https://www.tiktok.com/embed/v2/${id}`; } }

    renderProducts(d.products || defaultContent.products);

    const methods = d?.payment?.shipping?.methods || defaultContent.payment.shipping.methods;
    const defId   = d?.payment?.shipping?.defaultMethodId || methods[0]?.id;
    renderShipping(methods, defId);

    renderBlog(d.blog || defaultContent.blog);

    $('#paypalWarn').textContent = d.paypalBusiness ? "" : "Aseta PayPal-sähköposti backendissä (ADMIN) ennen julkaisuversiota.";
  }

  function renderProducts(list){
    const root = document.getElementById('productsRoot');
    root.innerHTML = "";
    list.forEach((p,idx)=>{
      const pairId = `pair-${idx}`;
      const leftId=`${pairId}-a`, rightId=`${pairId}-b`;
      const prevId=`${pairId}-prev`, nextId=`${pairId}-next`;

      const gallery = el('div',{class:'rounded-xl', style:`background:${getComputedStyle(document.documentElement).getPropertyValue('--gallery')||'#F6F6F4'}`},
        el('div',{class:'relative'},
          el('div',{class:'grid md:grid-cols-2 gap-4 md:gap-6'},
            el('div',{class:'aspect-[4/5] overflow-hidden rounded-xl ring-1 ring-stone-200'},
              el('img',{id:leftId,class:'w-full h-full object-cover',alt:`${p.name} kuva 1`,loading:'lazy',decoding:'async'})
            ),
            el('div',{class:'aspect-[4/5] overflow-hidden rounded-xl ring-1 ring-stone-200'},
              el('img',{id:rightId,class:'w-full h-full object-cover',alt:`${p.name} kuva 2`,loading:'lazy',decoding:'async'})
            )
          ),
          el('button',{id:prevId,class:'absolute left-2 top-1/2 -translate-y-1/2 p-3 rounded-full bg-white/90 backdrop-blur border border-stone-300 shadow-soft',ariaLabel:'Edelliset kuvat'},'◀'),
          el('button',{id:nextId,class:'absolute right-2 top-1/2 -translate-y-1/2 p-3 rounded-full bg-white/90 backdrop-blur border border-stone-300 shadow-soft',ariaLabel:'Seuraavat kuvat'},'▶')
        )
      );

      const details = el('div',{class:'mt-6 text-center'},
        el('h3',{class:'serif text-2xl'}, p.name||'Tuote'),
        el('p',{class:'mt-1 text-stone-700 max-w-2xl mx-auto'}, p.blurb||''),
        el('div',{class:'mt-2 font-semibold text-lg'}, fmtEUR(Number(p.price||0))),
        el('div',{class:'mt-3'}, el('button',{'data-add':p.id,class:'btn btn-dark'},'Lisää koriin'))
      );

      const wrap = el('div',{}, gallery, details);
      root.appendChild(wrap);

      const imgs = Array.isArray(p.images)&&p.images.length ? p.images : ["https://placehold.co/1400x1750?text=Kuva+1","https://placehold.co/1400x1750?text=Kuva+2","https://placehold.co/1400x1750?text=Kuva+3"];
      let i=0; const setPair=(k)=>{ const a=$(`#${leftId}`), b=$(`#${rightId}`); const n=imgs.length; a.src=imgs[(k%n+n)%n]; b.src=imgs[((k+1)%n+n)%n]; };
      setPair(i);
      $(`#${nextId}`).addEventListener('click',()=>{i=(i+1)%imgs.length; setPair(i);});
      $(`#${prevId}`).addEventListener('click',()=>{i=(i-1+imgs.length)%imgs.length; setPair(i);});
    });

    root.addEventListener('click', e=>{
      const btn = e.target.closest('[data-add]');
      if(!btn) return;
      addToCart(btn.getAttribute('data-add'));
    });
  }

  function renderBlog(posts){
    const root = document.getElementById('blogRoot');
    root.innerHTML='';
    posts.forEach(p=>{
      root.appendChild(
        el('article',{class:'bg-white rounded-xl ring-1 ring-stone-200 p-6 md:p-8'},
          el('h3',{class:'text-2xl font-semibold mb-2'}, p.title||'Postaus'),
          el('p',{class:'text-stone-700'}, p.body||'')
        )
      );
    });
  }

  // Ostoskori
  const $cart   = $('#cartDrawer');
  const $items  = $('#cartItems');
  const $open   = $('#openCart');
  const $close  = $('#closeCart');
  const $closeX = $('#closeCartX');
  const $sub    = $('#subTotal');
  const $ship   = $('#shipTotal');
  const $grand  = $('#grandTotal');
  const $count  = $('#cartCount');
  const $shipOpts = $('#shipOptions');

  let CART = JSON.parse(localStorage.getItem('cart')||'{}');
  function saveCart(){ localStorage.setItem('cart', JSON.stringify(CART)); updateBadge(); }
  function updateBadge(){ $count.textContent = Object.values(CART).reduce((a,b)=>a+b,0); }
  function openCart(){ $cart.classList.add('open'); renderCart(); }
  function closeCart(){ $cart.classList.remove('open'); }
  $open.onclick=openCart; $close.onclick=closeCart; $closeX.onclick=closeCart;

  function catalogFromContent(){ const cat={}; (CONTENT.products||[]).forEach(p=>{ cat[p.id]={id:p.id,name:p.name,price:Number(p.price||0)}; }); return cat; }

  function renderShipping(methods, defId){
    $shipOpts.innerHTML='';
    methods.forEach((m,idx)=>{
      const id = `ship-${m.id}`;
      const radio = el('label',{class:'flex items-center gap-2 text-sm'},
        el('input',{type:'radio',name:'ship',value:String(priceNum(m.price)),id, ...(m.id===defId || (!defId&&idx===0)?{checked:true}:{}) }),
        `${m.name} (${typeof m.price==='number' ? fmtEUR(m.price) : m.price})`
      );
      $shipOpts.appendChild(radio);
    });
    $shipOpts.querySelectorAll('input[name="ship"]').forEach(r=>r.addEventListener('change', renderCart));

    const ul = document.getElementById('shipInfo'); ul.innerHTML='';
    methods.forEach(m=>ul.appendChild(el('li',{}, `${m.name} — ${typeof m.price==='number'?fmtEUR(m.price):m.price}`)));
  }

  function renderCart(){
    const cat = catalogFromContent();
    $items.innerHTML='';
    const ids=Object.keys(CART);
    if(ids.length===0){ $items.innerHTML='<div class="text-sm text-stone-500 p-3">Ostoskori on tyhjä.</div>'; }
    let sub=0;
    ids.forEach(id=>{
      const p = cat[id]; if(!p) return;
      const q = CART[id];
      sub += p.price*q;
      const row = el('div',{class:'py-3 flex items-center justify-between gap-3'},
        el('div',{},
          el('div',{class:'font-medium'}, p.name),
          el('div',{class:'text-sm text-stone-600', html:`${fmtEUR(p.price)} × 
            <button class="px-2 ring-1 ring-stone-300 rounded" data-dec="${id}">–</button>
            <span class="mx-1">${q}</span>
            <button class="px-2 ring-1 ring-stone-300 rounded" data-inc="${id}">+</button>`})
        ),
        el('div',{class:'font-medium'}, fmtEUR(p.price*q))
      );
      $items.appendChild(row);
    });
    $sub.textContent = fmtEUR(sub);

    const shipVal = parseFloat((document.querySelector('input[name="ship"]:checked')||{value:"0"}).value || '0');
    $ship.textContent = fmtEUR(shipVal);
    $grand.textContent = fmtEUR(sub + shipVal);

    $items.querySelectorAll('[data-dec]').forEach(b=>b.onclick=()=>{ const id=b.dataset.dec; CART[id]=Math.max(0,(CART[id]||0)-1); if(CART[id]===0) delete CART[id]; saveCart(); renderCart(); });
    $items.querySelectorAll('[data-inc]').forEach(b=>b.onclick=()=>{ const id=b.dataset.inc; CART[id]=(CART[id]||0)+1; saveCart(); renderCart(); });
  }
  function addToCart(id){ CART[id]=(CART[id]||0)+1; saveCart(); openCart(); }
  updateBadge();

  document.getElementById('checkout').addEventListener('click', ()=>{
    const ids = Object.keys(CART);
    if(ids.length===0) return alert('Lisää tuotteita koriin.');
    const cat = catalogFromContent();
    const email = CONTENT.paypalBusiness || "kauppa@esimerkki.fi";
    const form = el('form',{method:'POST', action:'https://www.paypal.com/cgi-bin/webscr', target:'_blank'},
      el('input',{type:'hidden',name:'cmd',value:'_cart'}),
      el('input',{type:'hidden',name:'upload',value:'1'}),
      el('input',{type:'hidden',name:'business',value:email}),
      el('input',{type:'hidden',name:'currency_code',value:'EUR'}),
      el('input',{type:'hidden',name:'return',value: location.origin+'/#success'}),
      el('input',{type:'hidden',name:'cancel_return',value: location.origin+'/#cancel'})
    );
    let i=1;
    ids.forEach(id=>{
      const p=cat[id], q=CART[id]; if(!p||!q) return;
      form.appendChild(el('input',{type:'hidden',name:`item_name_${i}`,value:p.name}));
      form.appendChild(el('input',{type:'hidden',name:`amount_${i}`,   value:p.price.toFixed(2)}));
      form.appendChild(el('input',{type:'hidden',name:`quantity_${i}`, value:q}));
      i++;
    });
    const shipVal = parseFloat((document.querySelector('input[name="ship"]:checked')||{value:"0"}).value || '0');
    form.appendChild(el('input',{type:'hidden',name:'handling_cart',value:shipVal.toFixed(2)}));
    document.body.appendChild(form); form.submit(); form.remove();
  });

  (function(){
    const modal = $('#resultModal'); const title=$('#resultTitle'); const text=$('#resultText');
    function show(t,msg){ title.textContent=t; text.textContent=msg; modal.classList.add('open'); }
    if(location.hash==='#success'){ CART={}; saveCart(); show('Kiitos tilauksesta!','Vahvistus saapuu PayPal-sähköpostiisi.'); }
    if(location.hash==='#cancel'){ show('Maksu peruttu','Voit yrittää uudelleen tai muokata koria.'); }
    modal.addEventListener('click', e=>{ if(e.target===modal) modal.classList.remove('open'); });
  })();

  // ===== WebGL Revontulet – kevyt elävä liike, ei scrollaa =====
  (function(){
    const SETTINGS = {
      PAL_COL1:[0.02,0.70,0.95], // sinertävä
      PAL_COL2:[0.00,1.00,0.60], // vihreä
      BRIGHTNESS:1.00,
      CURTAIN_Y:0.58,
      HEIGHT:0.55,
      SPEED:0.18,           // pieni, jatkuva liike
      STRIPE_STRENGTH:0.22, // hillitty raitailu
      STAR_DENS:0.0001      // harvat tähdet → vähemmän "rakeisuutta"
    };

    function init(){
      const canvas = document.getElementById('auroraCanvas'); if(!canvas) return;
      const gl = canvas.getContext('webgl',{antialias:false,depth:false,stencil:false,preserveDrawingBuffer:false});
      if(!gl){ canvas.style.background='linear-gradient(#0a1e2a,#0b3824)'; return; }

      const vert=`attribute vec2 a_pos; void main(){ gl_Position=vec4(a_pos,0.,1.); }`;
      const frag=`precision highp float; uniform vec2 u_res; uniform float u_time,u_brightness,u_y,u_height,u_speed,u_stripes,u_star; uniform vec3 u_c1,u_c2;
      float hash(vec2 p){ return fract(sin(dot(p,vec2(127.1,311.7)))*43758.5453123);}
      float noise(vec2 p){vec2 i=floor(p),f=fract(p); float a=hash(i),b=hash(i+vec2(1,0)),c=hash(i+vec2(0,1)),d=hash(i+vec2(1,1));
        vec2 u=f*f*(3.-2.*f); return mix(mix(a,b,u.x),mix(c,d,u.x),u.y);}
      float fbm(vec2 p){float v=0.,a=0.5;for(int i=0;i<6;i++){v+=a*noise(p);p*=2.03;a*=0.47;}return v;}
      float stars(vec2 uv){ vec2 p=floor(uv*900.); float rnd=hash(p); return step(1.-u_star,rnd); }
      void main(){
        vec2 uv=gl_FragCoord.xy/u_res.xy, suv=vec2(uv.x*(u_res.x/u_res.y),uv.y);
        vec3 col=vec3(.02,.06,.12);
        float band=1.-smoothstep(0.,u_height,abs(uv.y-u_y));
        float t=u_time*u_speed;
        float flow=fbm(vec2(suv.x*1.6 - t, suv.y*1.2 + t*.35));
        float stripes=smoothstep(.38,1., fbm(vec2(suv.x*10.+t*1.2,t*2.)))*u_stripes;
        float inten=band*(.52+.72*flow)+stripes*band;
        float skyfade=smoothstep(0.,.25,uv.y); inten*=skyfade;
        vec3 pal=mix(u_c1,u_c2, clamp(uv.y + 0.22*flow,0.,1.));
        col=mix(col,pal, clamp(inten*1.18,0.,1.));
        float g=0.; g+=band*.20; g+=fbm(vec2(suv.x*1.8 - t*.4,suv.y*1.8))*.12; col += pal*g*1.03;
        float st=stars(uv); col+=vec3(st)*.32;
        col*=u_brightness;
        gl_FragColor=vec4(col,1.);
      }`;

      const sh=(t,s)=>{const o=gl.createShader(t); gl.shaderSource(o,s); gl.compileShader(o);
        if(!gl.getShaderParameter(o,gl.COMPILE_STATUS)){console.error(gl.getShaderInfoLog(o));} return o;};
      const prog=gl.createProgram();
      gl.attachShader(prog,sh(gl.VERTEX_SHADER,vert));
      gl.attachShader(prog,sh(gl.FRAGMENT_SHADER,frag));
      gl.linkProgram(prog);
      if(!gl.getProgramParameter(prog,gl.LINK_STATUS)){ console.error(gl.getProgramInfoLog(prog)); return; }
      gl.useProgram(prog);

      const buf=gl.createBuffer(); gl.bindBuffer(gl.ARRAY_BUFFER,buf); gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([-1,-1,3,-1,-1,3]),gl.STATIC_DRAW);
      const aPos=gl.getAttribLocation(prog,'a_pos'); gl.enableVertexAttribArray(aPos); gl.vertexAttribPointer(aPos,2,gl.FLOAT,false,0,0);

      const uRes=gl.getUniformLocation(prog,'u_res'), uTime=gl.getUniformLocation(prog,'u_time'), uBr=gl.getUniformLocation(prog,'u_brightness'),
            uY=gl.getUniformLocation(prog,'u_y'), uH=gl.getUniformLocation(prog,'u_height'), uSpd=gl.getUniformLocation(prog,'u_speed'),
            uStr=gl.getUniformLocation(prog,'u_stripes'), uStar=gl.getUniformLocation(prog,'u_star'),
            uC1=gl.getUniformLocation(prog,'u_c1'), uC2=gl.getUniformLocation(prog,'u_c2');

      function setUniforms(t){
        gl.uniform2f(uRes,canvas.width,canvas.height);
        gl.uniform1f(uTime,t);
        gl.uniform1f(uBr,SETTINGS.BRIGHTNESS);
        gl.uniform1f(uY,SETTINGS.CURTAIN_Y);
        gl.uniform1f(uH,SETTINGS.HEIGHT);
        gl.uniform1f(uSpd,SETTINGS.SPEED);
        gl.uniform1f(uStr,SETTINGS.STRIPE_STRENGTH);
        gl.uniform1f(uStar,SETTINGS.STAR_DENS);
        gl.uniform3fv(uC1,SETTINGS.PAL_COL1);
        gl.uniform3fv(uC2,SETTINGS.PAL_COL2);
      }
      function draw(t){ setUniforms(t*0.001); gl.drawArrays(gl.TRIANGLES,0,3); requestAnimationFrame(draw); }

      const ro=new ResizeObserver(()=>{ const DPR=Math.min(devicePixelRatio||1,2);
        const rect=canvas.getBoundingClientRect(); const dw=Math.floor(rect.width*DPR), dh=Math.floor(rect.height*DPR);
        if(canvas.width!==dw||canvas.height!==dh){ canvas.width=dw; canvas.height=dh; gl.viewport(0,0,dw,dh); }
      });
      ro.observe(canvas);

      requestAnimationFrame(draw);
    }
    if(document.readyState==='loading') addEventListener('DOMContentLoaded',init,{once:true}); else init();
  })();

  // Start
  loadContent();
  </script>
</body>
</html>
