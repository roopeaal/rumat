<!doctype html>
<html lang="fi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>RUMAT STUDIO ‚Äì ajattomia ja kest√§vi√§ kaavoja ja digiohjeita</title>
  <meta name="description" content="RUMAT STUDIO ‚Äì ajattomia ja kest√§vi√§ kaavoja ja digiohjeita.">
  <link rel="icon" href="assets/favicon.ico">
  <link rel="preload" as="image" href="assets/hero.jpg">
  <link rel="preload" as="image" href="assets/intro-left.jpg">
  <link rel="preload" as="image" href="assets/intro-right.jpg">
  <link rel="preload" as="image" href="assets/dog-sticker.png">

  <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800;900&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root{
      --ink:#202020; --olive:#A1A266; --deep-blue:#345563; --ivory:#F6F6F4; --light-blue:#DEEEEE;
      --header-h:64px; --band-radius:16px;
      --intro-img-w: clamp(160px, 24vw, 260px);
      --intro-img-h: clamp(300px, 36vw, 420px);
    }
    html{scroll-padding-top:var(--header-h)}
    body{font-family:Montserrat,system-ui,Segoe UI,Roboto,Arial;color:var(--ink);background:var(--ivory);margin:0;overflow-x:hidden;touch-action:pan-y;overscroll-behavior-y:contain}
    h1,h2,h3,h4,h5,h6{font-weight:900!important;text-transform:uppercase;color:var(--deep-blue);letter-spacing:.02em;margin:0 0 .6rem}
    .normalcase{text-transform:none!important}

    header{background:var(--ivory);border-bottom:1px solid rgba(0,0,0,.08)}
    #hdrRow{position:relative;display:grid;grid-template-columns:auto 1fr auto;align-items:center}
    #brandText{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:min(42vw,460px);color:var(--ink)}
    #brandText .strong{font-weight:900}#brandText .light{font-weight:600}
    #mainNav{justify-self:center;display:flex;gap:1.2rem;white-space:nowrap;font-size:13px;text-transform:uppercase;letter-spacing:.2em}
    #mainNav a{color:var(--ink);text-decoration:none}
    #rightBlock{justify-self:end;display:flex;align-items:center;gap:.5rem}
    .cart-text-btn{border:1px solid rgba(0,0,0,.16);padding:.45rem .8rem;border-radius:9999px;background:rgba(0,0,0,.04)}
    .btn{border-radius:9999px;padding:.6rem 1rem;border:1px solid rgba(0,0,0,.16);background:rgba(0,0,0,.04)}

    /* HERO */
    .hero{position:relative;height:calc(100dvh - var(--header-h));display:grid;place-items:center;overflow:hidden;background:#000}
    .hero-img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}
    .svg-logo{--logo-color:var(--light-blue);display:inline-block;width:9rem;height:9rem;background-color:var(--logo-color);-webkit-mask:url('assets/logo.svg') no-repeat center/contain;mask:url('assets/logo.svg') no-repeat center/contain}
    @media (min-width:640px){.svg-logo{width:11rem;height:11rem}}
    @media (min-width:1024px){.svg-logo{width:12rem;height:12rem}}
    .logo-light{--logo-color:var(--light-blue)}
    .svg-logo--header{width:3.1rem;height:3.1rem}
    .logo-beat{animation:logoBeat 1.2s ease-in-out infinite;filter:drop-shadow(0 6px 22px rgba(52,85,99,.25))}
    @keyframes logoBeat{0%{transform:scale(1)}12%{transform:scale(1.12)}24%{transform:scale(1.02)}36%{transform:scale(1.1)}48%{transform:scale(1)}100%{transform:scale(1)}}
    @media (prefers-reduced-motion:reduce){.logo-beat{animation:none}}

    .band{background:var(--ivory);border-radius:var(--band-radius);overflow:hidden}
    .band-inner{max-width:72rem;margin:0 auto;padding:3rem 1rem}

    /* Intro palkki */
    .intro-wide{margin-left:calc(50% - 50vw);margin-right:calc(50% - 50vw)}
    .intro-grid{display:grid;grid-template-columns:var(--intro-img-w) minmax(300px,64rem) var(--intro-img-w);gap:14px;align-items:start;padding:18px 0}
    .intro-img{background-size:cover;background-position:center;background-repeat:no-repeat;min-height:320px;height:var(--intro-img-h);border:1px solid rgba(0,0,0,.12);border-radius:18px;background-color:#ddd;will-change:transform;transform:translateZ(0)}
    .intro-img.left{background-image:url('assets/intro-left.jpg')}
    .intro-img.right{background-image:url('assets/intro-right.jpg')}
    .intro-copy{padding:6px 12px;min-width:0}
    .intro-copy .logo{width:56px;height:56px;display:block;margin:0 auto 12px;object-fit:contain}
    .intro-copy p{margin:0 0 .8rem;line-height:1.6}
    @media (max-width:900px){.intro-grid{grid-template-columns:1fr}.intro-img{height:clamp(240px,52vw,360px);border-radius:14px;transform:none}}

    /* Kaaviot + expander (mobiilissa 1 sarake) */
    .pattern-grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
    @media (max-width:640px){.pattern-grid{grid-template-columns:1fr;gap:10px}}
    @media (min-width:768px){.pattern-grid{grid-template-columns:repeat(4,minmax(0,1fr));gap:14px}}
    .tile{position:relative;cursor:pointer;aspect-ratio:1/1;display:block;transition:transform .12s linear,box-shadow .12s linear;will-change:transform}
    .tile:hover{transform:translateY(-1px);box-shadow:0 3px 10px rgba(0,0,0,.05)}
    .tile img{width:100%;height:100%;object-fit:cover;display:block}
    .tile-caption{position:absolute;left:0;right:0;bottom:0;padding:.45rem .65rem;background:linear-gradient(to top,rgba(0,0,0,.55),rgba(0,0,0,0));color:#fff;font-weight:800;letter-spacing:.06em;text-transform:uppercase;font-size:.85rem}

    .expander{grid-column:1/-1;background:var(--ivory);border-radius:16px;border:1px solid rgba(0,0,0,.12);overflow:hidden}
    .ex-top{display:flex;align-items:center;justify-content:space-between;gap:.75rem;padding:.6rem .9rem;border-bottom:1px solid rgba(0,0,0,.1)}
    .ex-row{display:grid;grid-template-columns:1fr;min-height:260px}
    @media (min-width:1024px){.ex-row{grid-template-columns:minmax(0,1.6fr) minmax(0,1fr)}}
    .ex-view{position:relative;background:#000}
    /* Mobiilissa kompakti ja joustava korkeus */
    .ex-view{min-height:clamp(50vh, 66vw, 70vh)}
    @media (min-width:640px){.ex-view{min-height:min(70vh,1200px)}}
    .ex-view img{width:100%;height:100%;object-fit:contain;background:#000;display:block}
    .ex-prev,.ex-next{position:absolute;top:50%;transform:translateY(-50%);width:42px;height:42px;display:grid;place-items:center;border-radius:9999px;background:var(--ivory);border:1px solid rgba(0,0,0,.15);font-weight:800}
    .ex-prev{left:10px}.ex-next{right:10px}
    .ex-info{padding:1rem 1.1rem;overflow:auto}

    /* Footer */
    .footer-bar{background:var(--olive);color:var(--ink)}
    .footer-grid{max-width:72rem;margin:0 auto;padding:1.5rem 1rem;display:grid;gap:1rem 2rem;align-items:start;grid-template-columns:1fr 1fr 1fr;grid-template-areas:"social contact logo"}
    .footer-logoBox{grid-area:logo;display:flex;justify-content:flex-end;align-items:flex-start;font-size:5.6rem;line-height:1}
    .svg-logo--footer{width:1em;height:1em;aspect-ratio:1/1}
    .footer-copy{text-align:center;font-size:.85rem;opacity:.85;padding:10px 1rem 16px}
    @media (max-width:860px){.footer-grid{grid-template-columns:1fr 1fr;grid-template-areas:"contact logo" "social logo"}.footer-logoBox{justify-content:center;font-size:4rem}}

    /* Scenes */
    .scene{position:relative;height:200dvh}
    @media (max-width:900px){ .scene{height:180dvh} }
    .scene-sticky{position:sticky;top:var(--header-h);height:calc(100dvh - var(--header-h));overflow:hidden;contain:layout paint;backface-visibility:hidden}
    .panel{position:absolute;inset:0;will-change:transform,opacity;transform:translateZ(0)}
    .panelCentered{display:grid;place-items:center}
    #scene-intro .panel-dog{z-index:2;transform:translate3d(0,0,0);opacity:1}
    #scene-intro .panel-intro{z-index:1;transform:translate3d(100%,0,0);opacity:0}
    .panel-dog img.dog-sticker{width:clamp(72px,11vw,120px);height:auto;pointer-events:none}

    /* Suunnittelija ‚Äì maski tekstipalstalle */
    .designer-text-wrap{position:relative}
    .designer-mask-svg{position:absolute;inset:0;pointer-events:none;z-index:5;width:100%;height:100%;will-change:transform;transform:translateZ(0);transform-box:fill-box;transform-origin:center top}
    @media (max-width:900px){.designer-mask-svg{transform:scaleX(1.14)}}

    @media (prefers-reduced-motion:reduce){
      .scene{height:auto}.scene-sticky{position:relative;height:auto}
      #scene-intro .panel-intro,#scene-intro .panel-dog{transform:none!important;opacity:1!important}
      .designer-mask-svg{display:none}
    }
  </style>
</head>

<body>
<header class="fixed top-0 left-0 right-0 z-50">
  <div id="hdrRow" class="mx-auto max-w-6xl px-4 py-4 grid gap-3">
    <a id="brandBlock" href="#etusivu" aria-label="Etusivu" class="flex items-center gap-3 min-w-0">
      <span class="svg-logo svg-logo--header logo-light" role="img" aria-label="RUMAT STUDIO"></span>
      <span id="brandText" class="uppercase text-sm tracking-widest"><span class="strong">RUMAT</span>&nbsp;<span class="light">STUDIO</span></span>
    </a>

    <nav id="mainNav" class="justify-self-center">
      <a href="#mikaonrumat"  class="hover:underline underline-offset-4">Mik√§ on RUMAT?</a>
      <a href="#kaaviot"      class="hover:underline underline-offset-4">Kaavat</a>
      <a href="#suunnittelija"class="hover:underline underline-offset-4">Suunnittelija</a>
      <a href="#yhteys"       class="hover:underline underline-offset-4">Ota yhteytt√§</a>
    </nav>

    <div id="rightBlock" class="flex items-center gap-2">
      <button id="openCartText" class="cart-text-btn">Ostoskori <span id="cartCountText" class="opacity-80"></span></button>
    </div>
  </div>
</header>

<main class="pt-[64px]">
  <!-- HERO -->
  <section id="etusivu" class="hero px-4">
    <img src="assets/hero.jpg" alt="RUMAT STUDIO hero" class="hero-img" onerror="this.onerror=null;this.src='assets/placeholder.jpg'">
    <span class="svg-logo logo-light logo-beat" role="img" aria-label="RUMAT STUDIO"></span>
  </section>

  <!-- SCENE 1: KOIRA ‚Üí ESITTELY -->
  <section id="scene-intro" class="scene">
    <div class="scene-sticky">
      <div class="panel panel-dog panelCentered" aria-label="Koira tarra">
        <img class="dog-sticker" id="dogSticker" alt="Koira tarra" loading="eager" decoding="async">
      </div>

      <section id="mikaonrumat" class="panel panel-intro">
        <div class="band full-bleed">
          <div class="band-inner">
            <h2 class="mb-4">Liian rumat ollakseen totta</h2>
            <div class="intro-wide">
              <div class="intro-grid">
                <div class="intro-img left" aria-hidden="true"></div>
                <div class="intro-copy">
                  <img class="logo" src="assets/logo.svg" alt="RUMAT STUDIO" onerror="this.onerror=null;this.src='assets/placeholder.jpg'">
                  <div id="intro-text" class="text-[15px] sm:text-base normalcase"></div>
                </div>
                <div class="intro-img right" aria-hidden="true"></div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>
  </section>

  <!-- KAAVIOT -->
  <section id="kaaviot" class="py-0">
    <div class="band full-bleed">
      <div class="band-inner">
        <h2 class="text-3xl mb-4">Kaavat</h2>
        <div id="patternsGrid" class="pattern-grid"></div>
      </div>
    </div>
  </section>

  <!-- SCENE 2: SUUNNITTELIJA -->
  <section id="scene-designer" class="scene">
    <div class="scene-sticky">
      <section id="suunnittelija" class="onstage">
        <div class="band full-bleed" style="height:100%;display:flex;align-items:center">
          <div class="band-inner" style="width:100%">
            <h2 class="text-3xl mb-4">Suunnittelija</h2>
            <div class="grid md:grid-cols-[320px_1fr] gap-6 items-start">
              <div><img id="designerPhoto" src="assets/designer.jpg" onerror="this.onerror=null;this.src='assets/placeholder.jpg';" alt="Suunnittelija" class="rounded-xl border border-[rgba(0,0,0,.12)] object-cover w-full h-[300px] md:h-[420px]"></div>
              <div class="designer-text-wrap space-y-4 normalcase">
                <svg id="designerMaskText" class="designer-mask-svg" viewBox="0 0 100 100" preserveAspectRatio="none" aria-hidden="true">
                  <defs>
                    <mask id="smileyMaskText">
                      <rect x="0" y="0" width="100" height="100" fill="white"/>
                      <rect x="40" y="6" width="5" height="44" rx="2" fill="black"/>
                      <rect x="55" y="6" width="5" height="44" rx="2" fill="black"/>
                      <path d="M28 56 C 44 92, 56 92, 72 56" fill="none" stroke="black" stroke-width="9" stroke-linecap="round"/>
                    </mask>
                  </defs>
                  <rect x="0" y="0" width="100" height="100" fill="var(--ivory)" mask="url(#smileyMaskText)"/>
                </svg>

                <p>Aaltonen on itsevarma neuloja, joka ei rajoita luovuuttaan vain yhteen tekemisen tapaan. Neulomisen rinnalla my√∂s asusteiden ompelu on t√§rke√§ osa ilmaisua ‚Äì ja ennen kaikkea intohimo. Lapsuuden kiinnostus vaatteiden suunnitteluun johti muodin ja tekstiilisuunnittelun opintoihin vuonna 2021.</p>
                <p>Pian Aaltonen valmistuu taiteen maisteriksi, mukanaan vankka osaaminen ja omat suosikkitekniikat, joita h√§n on hionut opintojen aikana. Neulomisen ja asusteiden lis√§ksi Aaltonen on syventynyt erityisesti vaatteiden kierr√§tykseen, korjaamiseen liittyviin asenteisiin sek√§ kriittiseen tarkasteluun siit√§, miten kuluttamista ohjataan ‚Äì ja millaisia seurauksia sill√§ on ymp√§rist√∂lle.</p>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>
  </section>

  <footer id="yhteys" class="footer-bar">
    <div class="footer-grid">
      <div class="footer-social">
        <div class="footer-col"><h6>Instagram</h6><a class="footer-handle" href="https://instagram.com/rumat.studio" target="_blank" rel="noreferrer">rumat.studio</a></div>
        <div class="footer-col"><h6>TikTok</h6><a class="footer-handle" href="https://www.tiktok.com/@rumat.studio" target="_blank" rel="noreferrer">rumat.studio</a></div>
      </div>
      <div class="footer-contact">
        <div class="footer-col"><h6>Ota yhteytt√§</h6><a class="footer-link" href="mailto:aaltonen96@outlook.com">aaltonen96@outlook.com</a></div>
        <div class="footer-col">
          <div class="footer-ytunnus">Y-3436822-5</div>
          <div class="mt-2 flex flex-col gap-1 text-sm">
            <a class="footer-link" href="legal/privacy.html" target="_blank" rel="noopener">Tietosuojaseloste (PDF)</a>
            <a class="footer-link" href="legal/terms.html"   target="_blank" rel="noopener">Toimitus- ja sopimusehdot (PDF)</a>
          </div>
        </div>
      </div>
      <div class="footer-logoBox"><span class="svg-logo svg-logo--footer logo-light" role="img" aria-label="RUMAT STUDIO"></span></div>
    </div>
    <div class="footer-copy">¬© <span id="year"></span> RUMAT STUDIO</div>
  </footer>
</main>

<script>
/* ===== Helpers ===== */
const $=s=>document.querySelector(s);
const ca=(t,attrs={})=>Object.assign(document.createElement(t),attrs);
(()=>{const y=$('#year');if(y)y.textContent=new Date().getFullYear()})();

/* Intro teksti */
(()=>{
  const s=`RUMAT STUDIO syntyi lapsuuden haaveesta ja vuosien aikana kypsyneest√§ intohimosta vaatesuunnitteluun. Vuonna 2023 visio alkoi muovautumaan nykyiseen muotoonsa: ajattomia ja kest√§vi√§ vaatteita, jotka syntyv√§t harkitusta rakkaudesta ja intohimosta luovaan tekemiseen.

RUMAT STUDIO pohjautuu vahvaan arvopohjaan. Se ei ole pelkk√§ tuotemerkki, vaan se rohkaisee pohtimaan omaa kulutusk√§ytt√§ytymist√§ ja inspiroi tekem√§√§n itse tai ainakin arvostamaan vaatteiden alkuper√§√§ ja tekij√∂it√§ niiden takana.

Taustalla on halu luoda ajattomia, kest√§vi√§ ja harkiten suunniteltuja vaatteita vastalauseena kertak√§ytt√∂iselle pikamuodille. Jokainen vaate suunnitellaan kest√§m√§√§n sek√§ k√§yt√∂ss√§ ett√§ ajassa. Suunnittelussa otetaan huomioon materiaalien laatu, vaatteen k√§ytt√∂tarkoitus ja visuaalinen ilme, mutta my√∂s tuotannon ekologinen ja eettinen kest√§vyys. K√§sity√∂n√§ valmistetut vaatteet vaativat aikaa ja siten nostavat vaatteen arvoa niin konkreettisesti kuin tunnearvossakin.

Tulevaisuuden suunnitelmissa on oman studiollisen avaaminen p√§√§kaupunkiseudulle. Tila toimisi kohtaamispaikkana, jossa voi sovittaa mallikappaleita, osallistua ty√∂pajoihin ja verkostoitua muiden kest√§v√§st√§ arvosta kiinnostuneiden muotoilijoiden, ompelijoiden ja suunnittelijoiden kanssa.

Jokainen ‚Äúliian RUMAT ollakseen totta‚Äù -tuote on suunniteltu huolella merkityksellisyydest√§ k√§ytt√∂mukavuuteen asti. Tavoitteena ei ole t√§ydellisyys, vaan rohkeus ja kehitys. Nimi RUMAT STUDIO viittaa juuri t√§h√§n: lapsen sallittuun keskener√§isyyteen, mutta t√§hd√§t√§ silti johonkin merkitykselliseen.`;
  const intro=$('#intro-text'); if(intro) intro.innerHTML=s.trim().split(/\n\s*\n/).map(p=>`<p>${p}</p>`).join('');
})();

/* Koira tarra (pienempi) */
(()=>{
  const img=$('#dogSticker'); if(!img) return;
  img.src='assets/dog-sticker.png';
  img.onerror=()=>{const e=ca('div',{textContent:'üê∂'}); e.style.cssText='font-size:12vw;line-height:1'; img.replaceWith(e);}
})();

/* Intro: oikea kuva laskee pehme√§sti tekstin mukaan */
(()=>{
  const copy=document.querySelector('.intro-copy');
  const right=document.querySelector('.intro-img.right');
  if(!copy||!right) return;
  let target=0, val=0, raf=0;
  function measure(){
    if (window.innerWidth<=900){ target=0; right.style.transform='translate3d(0,0,0)'; return; }
    const th=copy.offsetHeight, ih=right.offsetHeight;
    target=Math.max(0, th-ih);
  }
  function step(){
    raf=0;
    val += (target-val)*0.18;
    const y = Math.round(val);
    right.style.transform=`translate3d(0,${y}px,0)`;
    if(Math.abs(target-val)>0.35) raf=requestAnimationFrame(step);
  }
  function kick(){ if(!raf) raf=requestAnimationFrame(step); }
  new ResizeObserver(()=>{measure();kick();}).observe(copy);
  new ResizeObserver(()=>{measure();kick();}).observe(right);
  addEventListener('resize',()=>{measure();kick()},{passive:true});
  measure(); kick();
})();

/* Scenes (koira‚Üíintro & suunnittelija maski) */
(()=>{
  if (matchMedia('(prefers-reduced-motion: reduce)').matches) return;

  const HEADER = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--header-h'))||64;
  const sceneIntro = document.getElementById('scene-intro');
  const dogPanel   = sceneIntro?.querySelector('.panel-dog');
  const introPanel = sceneIntro?.querySelector('#mikaonrumat');
  const sceneDes   = document.getElementById('scene-designer');
  const maskSvg    = document.getElementById('designerMaskText');
  const photo      = document.getElementById('designerPhoto');

  const smoother=(p)=>p*p*p*(p*(6*p-15)+10);
  const clamp=(x)=>x<0?0:x>1?1:x;
  function vvh(){ return (window.visualViewport?.height || window.innerHeight || 800); }
  function stickyH(){ return Math.max(1, vvh() - HEADER); }

  const scenes=[];
  function measureScene(el){
    if(!el) return null;
    return { el, start: el.offsetTop, stick: stickyH(), total: Math.max(1, el.offsetHeight - stickyH()) };
  }
  function measureAll(){
    scenes.length=0;
    const a=measureScene(sceneIntro); if(a) scenes.push(a);
    const b=measureScene(sceneDes);   if(b) scenes.push(b);
  }

  let raf=0, navSkip=null;
  function render(){
    raf=0;
    const y=window.scrollY||0;
    const W=window.innerWidth;

    for(const s of scenes){
      const raw=clamp((y - s.start)/s.total);
      const p = (navSkip==='intro' && s.el===sceneIntro) ? 1 :
                (navSkip==='designer' && s.el===sceneDes) ? 1 : smoother(raw);

      if(s.el===sceneIntro && dogPanel && introPanel){
        const txDog   = Math.round(-W*1.05*p);
        const txIntro = Math.round(W*(1-p));
        dogPanel.style.transform   = `translate3d(${txDog}px,0,0)`;
        dogPanel.style.opacity     = (1 - p*1.1).toFixed(3);
        introPanel.style.transform = `translate3d(${txIntro}px,0,0)`;
        introPanel.style.opacity   = Math.min(1,p*1.15).toFixed(3);
      }

      if(s.el===sceneDes){
        const e = (navSkip==='designer') ? 1 : p*(2-p);
        const ty = Math.round(s.stick*(window.innerWidth<=900?0.85:0.6)*e);
        if(maskSvg) { maskSvg.style.transform=`translate3d(0,${ty}px,0) ${window.innerWidth<=900 ? 'scaleX(1.14)' : ''}`; }
        if(photo)   { const sc=0.985+0.045*e; photo.style.transform=`scale(${sc})`; }
      }
    }
  }
  function req(){ if(!raf) raf=requestAnimationFrame(render); }
  function renderNow(){ cancelAnimationFrame(raf); raf=0; render(); }

  window.__sceneNavSkip = (which)=>{ navSkip=which; renderNow(); };
  window.__sceneMeasure = ()=>{ measureAll(); renderNow(); };

  const onResize=()=>{ measureAll(); req(); };
  window.addEventListener('resize', onResize, {passive:true});
  window.visualViewport?.addEventListener('resize', onResize, {passive:true});
  window.addEventListener('orientationchange', onResize, {passive:true});
  window.addEventListener('scroll', req, {passive:true});
  document.addEventListener('DOMContentLoaded', ()=>{ measureAll(); renderNow(); });
})();

/* ===== Kaaviot: √§lyk√§s kuvien lataus + EXPANDER ===== */
function setSmartImage(img,bases){
  const exts=['.webp','.jpg','.jpeg','.png','.JPG','.JPEG','.PNG'];
  const c=[];(Array.isArray(bases)?bases:[bases]).forEach(b=>exts.forEach(e=>c.push(b+e)));
  let i=0;const next=()=>{ if(i>=c.length){img.src='assets/placeholder.jpg';return;}
    const url=c[i++]; const p=new Image(); p.onload=()=>img.src=url; p.onerror=next; p.src=url; }; next();
}

(()=>{
  const grid=$('#patternsGrid'); if(!grid) return;

  const DATA=[
    {id:'dummy-kaava',name:'Dummy kaava',price:0.01,sizes:'PDF',blurb:'V√§liaikainen testikaava ‚Äì korvataan my√∂hemmin oikeilla.',imgBase:'assets/patterns/dummy-kaava-1',images:['assets/patterns/dummy-kaava-1','assets/patterns/dummy-kaava-2'],deliverable:true},
    {id:'ilmainen-ohje',name:'Ilmainen ohje',price:0.00,sizes:'One size',blurb:'T√§ysin ilmainen kokeiltava ohje (dummy-PDF).',imgBase:'assets/patterns/ilmainen-ohje-1',images:['assets/patterns/ilmainen-ohje-1'],deliverable:true},
    {id:'takki',name:'Takki',price:0.01,sizes:'XS‚ÄìXL',blurb:'Tulossa pian.',imgBase:'assets/patterns/takki-1',images:['assets/patterns/takki-1'],deliverable:false},
    {id:'laukku',name:'Laukku',price:0.01,sizes:'One size',blurb:'Sling-laukku kaava (PDF).',imgBase:'assets/patterns/laukku-1',images:['assets/patterns/laukku-1','assets/patterns/laukku-2'],deliverable:false},
    {id:'usva-paita',name:'Usva paita',price:0.01,sizes:'XS‚ÄìXL',blurb:'Rento paita.',imgBase:'assets/patterns/usva-paita-1',images:['assets/patterns/usva-paita-1','assets/patterns/usva-paita-2'],deliverable:false},
    {id:'neule-panta',name:'Neule panta',price:0.01,sizes:'S‚ÄìL',blurb:'Helppo aloittelijalle.',imgBase:'assets/patterns/neule-panta-1',images:['assets/patterns/neule-panta-1'],deliverable:false},
    {id:'kauluri',name:'Kauluri',price:0.01,sizes:'One size',blurb:'Nopea viikonloppu.',imgBase:'assets/patterns/kauluri-1',images:['assets/patterns/kauluri-1'],deliverable:false},
    {id:'pipo',name:'Pipo',price:0.01,sizes:'S‚ÄìL',blurb:'Peruspipo.',imgBase:'assets/patterns/pipo-1',images:['assets/patterns/pipo-1'],deliverable:false},
    {id:'lapaset',name:'Lapaset',price:0.01,sizes:'S‚ÄìXL',blurb:'Tiivis peruslapanen.',imgBase:'assets/patterns/lapaset-1',images:['assets/patterns/lapaset-1'],deliverable:false},
    {id:'sukat',name:'Sukat',price:0.01,sizes:'36‚Äì46',blurb:'Vahvistettu kantap√§√§.',imgBase:'assets/patterns/sukat-1',images:['assets/patterns/sukat-1'],deliverable:false},
    {id:'villapaita',name:'Villapaita',price:0.01,sizes:'XS‚ÄìXXL',blurb:'Klassikko.',imgBase:'assets/patterns/villapaita-1',images:['assets/patterns/villapaita-1'],deliverable:false},
  ];

  // Render tiles
  DATA.forEach(p=>{
    const tile=ca('article',{className:'tile card','data-id':p.id});
    const img=ca('img',{alt:p.name,loading:'lazy',decoding:'async'}); setSmartImage(img,p.imgBase);
    const cap=ca('div',{className:'tile-caption'});
    const suffix=!p.deliverable?' ¬∑ Tulossa':(p.price===0?' ¬∑ Ilmainen':''); cap.textContent=p.name+suffix;
    tile.append(img,cap); grid.appendChild(tile);
  });

  // Luotettava sarakem√§√§r√§: lasketaan ensimm√§isen rivin kortit offsetTopin avulla
  function getCols(){
    const tiles=[...grid.querySelectorAll('.tile')];
    if(!tiles.length) return 1;
    const top0=tiles[0].offsetTop;
    let count=0;
    for(const t of tiles){ if(t.offsetTop!==top0) break; count++; }
    return Math.max(1,count);
  }

  // Expander
  let expander=null, current=null, imgIdx=0, selectedTile=null;
  const fmtEUR=x=>new Intl.NumberFormat('fi-FI',{style:'currency',currency:'EUR'}).format(x);

  function buildExpander(){
    expander=ca('div',{className:'expander'});
    const top=ca('div',{className:'ex-top'});
    top.append(ca('div',{id:'exTitle',className:'font-semibold'}), ca('button',{id:'exClose',className:'px-3 py-1 rounded border border-[rgba(0,0,0,.15)]',textContent:'Sulje'}));
    const row=ca('div',{className:'ex-row'});
    const view=ca('div',{className:'ex-view'});
    view.append(ca('img',{alt:'Kaava',loading:'eager',decoding:'async'}), ca('button',{id:'exPrev',className:'ex-prev',textContent:'‚óÄ'}), ca('button',{id:'exNext',className:'ex-next',textContent:'‚ñ∂'}));
    const info=ca('div',{className:'ex-info'});
    info.innerHTML=`<h3 id="exName" class="text-2xl mb-2"></h3>
      <div style="height:8px"></div>
      <p id="exBlurb" class="opacity-80 mb-2 normalcase"></p>
      <div class="mb-2"><span class="font-semibold">Koot: </span><span id="exSizes"></span></div>
      <div id="exPrice" class="text-xl font-bold mb-4"></div>
      <div id="exActions"></div>`;
    row.append(view,info); expander.append(top,row);

    expander.querySelector('#exPrev').addEventListener('click',()=>nav(-1));
    expander.querySelector('#exNext').addEventListener('click',()=>nav(+1));
    expander.querySelector('#exClose').addEventListener('click',clearSelection);
  }
  buildExpander();

  function setAfterRow(tileEl){
    const tiles=[...grid.querySelectorAll('.tile')];
    const idx=tiles.indexOf(tileEl);
    const cols=getCols();                 // ‚Üê luotettava sarakeluku
    const rowEnd = tiles[Math.min(tiles.length-1, Math.floor(idx/cols)*cols + (cols-1))];
    grid.insertBefore(expander, rowEnd.nextSibling);
  }

  function openFor(p,tileEl){
    current=p; imgIdx=0;
    expander.querySelector('#exTitle').textContent=p.name;
    expander.querySelector('#exName').textContent=p.name;
    expander.querySelector('#exBlurb').textContent=p.blurb||'';
    expander.querySelector('#exSizes').textContent=p.sizes||'';
    expander.querySelector('#exPrice').textContent=p.price===0?'ILMAINEN':fmtEUR(p.price||0);
    const exImg=expander.querySelector('.ex-view img'); setSmartImage(exImg, (p.images||[])[0]);
    const actions=expander.querySelector('#exActions'); actions.innerHTML='';
    const deliver=!!p.deliverable;
    if(!deliver){ actions.append(ca('span',{className:'inline-block px-4 py-2 rounded-full border border-[rgba(0,0,0,.15)]',textContent:'Tulossa'})); }
    else{ actions.append(ca('button',{className:'btn bg-[color:var(--deep-blue)] text-white rounded-full px-4 py-2',textContent:'Lis√§√§ ostoskoriin'})); }
    setAfterRow(tileEl);
  }

  function nav(dir){
    if(!current) return;
    const imgs=current.images||[]; if(!imgs.length) return;
    imgIdx=(imgIdx+dir+imgs.length)%imgs.length;
    const exImg=expander.querySelector('.ex-view img'); setSmartImage(exImg, imgs[imgIdx]);
  }

  function clearSelection(){
    if(!selectedTile) return;
    selectedTile.classList.remove('tile--selected');
    if(expander.parentNode===grid) grid.removeChild(expander);
    selectedTile=null; current=null; imgIdx=0;
  }

  grid.addEventListener('click',e=>{
    const tile=e.target.closest('.tile'); if(!tile||!grid.contains(tile)) return;
    if(tile===selectedTile){ clearSelection(); return; }
    clearSelection(); selectedTile=tile; tile.classList.add('tile--selected');
    const p=DATA.find(x=>x.id===tile.dataset.id); if(p) openFor(p,tile);
  });

  // Reflow expander oikein my√∂s ruudukon murtuessa / rotaatiossa
  let roTimer=null;
  const onResize=()=>{ if(!selectedTile) return; clearTimeout(roTimer); roTimer=setTimeout(()=>setAfterRow(selectedTile),80); };
  addEventListener('resize',onResize,{passive:true});
  window.visualViewport?.addEventListener('resize',onResize,{passive:true});
  addEventListener('orientationchange',onResize,{passive:true});
})();

/* ===== Ankkuri-linkit: ohita efektien alku/puoliv√§li ===== */
(()=>{
  const HEADER=parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--header-h'))||64;
  const vh=()=> (visualViewport?.height||innerHeight||800);
  const stickyH=()=> Math.max(1, vh()-HEADER);
  const scenePos=(sceneEl,progress)=>{const start=sceneEl.offsetTop,total=Math.max(1,sceneEl.offsetHeight-stickyH());return start+progress*total};
  function go(hash){
    if(!hash||hash==='#'||hash==='#etusivu'){window.__sceneNavSkip?.(null);scrollTo({top:0,behavior:'smooth'});return true;}
    if(hash==='#mikaonrumat'){const s=document.querySelector('#scene-intro');if(!s)return false;window.__sceneNavSkip?.('intro');scrollTo({top:scenePos(s,1),behavior:'smooth'});setTimeout(()=>window.__sceneMeasure?.(),10);return true;}
    if(hash==='#suunnittelija'){const s=document.querySelector('#scene-designer');if(!s)return false;window.__sceneNavSkip?.('designer');scrollTo({top:scenePos(s,0.08),behavior:'smooth'});setTimeout(()=>window.__sceneMeasure?.(),10);return true;}
    const el=document.querySelector(hash);if(el){window.__sceneNavSkip?.(null);el.scrollIntoView({behavior:'smooth'});return true;}
    return false;
  }
  document.getElementById('mainNav')?.addEventListener('click',e=>{
    const a=e.target.closest('a[href^="#"]');if(!a)return;
    const h=a.getAttribute('href');
    if(go(h)){e.preventDefault();history.pushState(null,'',h);}
  }, {passive:true});
  addEventListener('hashchange',()=>{go(location.hash)},{passive:true});
  document.addEventListener('DOMContentLoaded',()=>{go(location.hash)});
})();
</script>
</body>
</html>
