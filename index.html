<!doctype html>
<html lang="fi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>RUMAT STUDIO</title>

  <!-- Montserrat -->
  <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800;900&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root{
      --ink:#202020;         /* musta (tekstit) */
      --olive:#A1A266;       /* footer-tausta */
      --deep-blue:#345563;   /* otsikot */
      --blue:#789FAB;        /* varalle */
      --light-blue:#DEEEEE;  /* footer-logo tausta */
      --ivory:#F6F6F4;       /* taustat & yläpalkki */
      --header-h:56px;
      --section-gap: clamp(6px, 1vw, 12px);
      --band-radius: 16px;
    }
    html{ scroll-padding-top: var(--header-h); }
    body{ font-family:Montserrat,system-ui,Segoe UI,Roboto,Arial; color:var(--ink); background:var(--ivory); }

    /* Otsikot (hero-otsikko pidetään valkoisena) */
    h1,h2,h3{ color:var(--deep-blue); font-weight:800; }
    .hero h1{ color:var(--ivory); }

    /* Full-bleed helper + bandit */
    .full-bleed{ margin-left: calc(50% - 50vw); margin-right: calc(50% - 50vw); }
    .band{ background:#fff; border-radius: var(--band-radius); overflow:hidden; }
    .band--mist{ background: var(--light-blue); }
    .band--stone{ background: #f5f5f4; }
    .band-inner{ max-width: 72rem; margin:0 auto; padding: 3rem 1rem; }
    .aurora-gap{ height: var(--section-gap); pointer-events: none; background: transparent; }

    /* Header */
    header{ background:var(--ivory); border-bottom:1px solid rgba(0,0,0,.08); }
    #hdrRow{ grid-template-columns:auto 1fr auto; }
    #brandText{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:min(42vw, 460px); color:var(--ink); }
    #brandText .strong{ font-weight:800; }
    #brandText .light{ font-weight:600; }

    #mainNav{ justify-self:center; display:flex; gap:1.5rem; white-space:nowrap; font-size:13px; text-transform:uppercase; letter-spacing:.2em; color:var(--ink); }
    #mainNav a{ color:var(--ink); }
    .nav-hidden{ display:none !important; }
    .nav-measure{ position:absolute !important; visibility:hidden !important; display:flex !important; white-space:nowrap !important; }

    /* Right block */
    .icon-btn{ position:relative; width:38px; height:38px; display:grid; place-items:center; border-radius:9999px; background:rgba(0,0,0,0.06); border:1px solid rgba(0,0,0,0.16); color:var(--ink); }
    .icon-btn:hover{ background:rgba(0,0,0,0.10); }
    .cart-text-btn{ border:1px solid rgba(0,0,0,.16); padding:.45rem .8rem; border-radius:9999px; color:var(--ink); background:rgba(0,0,0,.04); }
    .cart-text-btn:hover{ background:rgba(0,0,0,.08); }
    .badge{ position:absolute; top:-4px; right:-4px; min-width:18px; height:18px; padding:0 4px; display:grid; place-items:center; border-radius:9999px; background:var(--ink); color:#fff; font-size:11px; font-weight:700; border:1px solid rgba(0,0,0,.15); }

    /* Drawers */
    .drawer{position:fixed;inset:0;z-index:60;display:none}
    .drawer.open{display:block}
    #menuDrawer .panel{position:absolute;top:0;left:0;right:auto;width:min(420px,90vw);height:100%;background:#fff;box-shadow:10px 0 30px rgba(0,0,0,.2)}
    #cartDrawer .panel{position:absolute;top:0;right:0;left:auto;width:min(420px,90vw);height:100%;background:#fff;box-shadow:-10px 0 30px rgba(0,0,0,.2)}

    /* HERO video tausta */
    .bg-video{
      position:fixed; inset:0; width:100%; height:100%;
      z-index:0; object-fit:cover; object-position:center;
      background:transparent;
      pointer-events:none;
    }
    .site-content{ position:relative; z-index:2; }

    .hero{ position:relative; height:100svh; display:grid; place-items:center; text-align:center; }

    /* Esittely: kuvat molemmissa reunoissa */
    .intro-grid{ display:grid; gap:1.25rem; align-items:center; }
    @media (min-width: 768px){ .intro-grid{ grid-template-columns: 1fr 2fr 1fr; } }
    .intro-img{ aspect-ratio: 4/5; object-fit:cover; width:100%; border-radius:14px; border:1px solid rgba(0,0,0,.12); }

    /* Kaaviot-galleria */
    .card{ background:#fff; border-radius:16px; border:1px solid rgba(0,0,0,.12); overflow:hidden; }
    .pattern-grid{ display:grid; grid-template-columns: repeat(2,minmax(0,1fr)); gap:12px; }
    @media (min-width: 768px){ .pattern-grid{ grid-template-columns: repeat(4,minmax(0,1fr)); gap:14px; } }

    .tile{ position:relative; cursor:pointer; }
    .tile img{ width:100%; height:220px; object-fit:cover; display:block; }
    @media (min-width:768px){ .tile img{ height:200px; } }

    .tile-caption{
      position:absolute; left:0; right:0; bottom:0;
      padding:.45rem .65rem;
      background: linear-gradient(to top, rgba(0,0,0,.55), rgba(0,0,0,.0));
      color:#fff; font-weight:700; letter-spacing:.06em; text-transform:uppercase; font-size:.85rem;
    }
    .tile--selected{ display:grid; place-items:center; height:220px; }
    @media (min-width:768px){ .tile--selected{ height:200px; } }
    .min-link{ color:var(--deep-blue); font-weight:700; text-decoration:underline; }

    .detail{ display:grid; gap:1rem; padding:1rem; }
    @media (min-width: 1024px){ .detail{ grid-template-columns: 1.5fr 1fr; padding:1.25rem; gap:1.25rem; } }
    .viewer{ position:relative; background:#000; border-radius:12px; overflow:hidden; min-height:280px; }
    .viewer img{ width:100%; height:100%; object-fit:contain; background:#000; }
    .navbtn{
      position:absolute; top:50%; transform:translateY(-50%);
      width:40px; height:40px; display:grid; place-items:center;
      border-radius:9999px; background:rgba(255,255,255,.85); border:1px solid rgba(0,0,0,.15); font-weight:800;
    }
    .navbtn.prev{ left:8px; } .navbtn.next{ right:8px; }

    /* Footer logo mask */
    .logo-mask{ width:36px; height:36px; background:var(--light-blue);
      -webkit-mask:url('assets/logo.svg') no-repeat center/contain; mask:url('assets/logo.svg') no-repeat center/contain; }
  </style>
</head>

<body>
  <!-- TAUSTA-VIDEO HEROA VARTEN -->
  <!-- Laita tiedostot assets/aurora.mp4, assets/aurora.webm ja assets/aurora-poster.jpg -->
  <video class="bg-video" id="bgVideo" autoplay muted loop playsinline poster="assets/aurora-poster.jpg">
    <source src="assets/aurora.webm" type="video/webm">
    <source src="assets/aurora.mp4"  type="video/mp4">
  </video>

  <!-- HEADER -->
  <header class="fixed top-0 left-0 right-0 z-50">
    <div id="hdrRow" class="mx-auto max-w-6xl px-4 py-3 grid items-center gap-3">
      <!-- Brand (vasen) -->
      <a id="brandBlock" href="#etusivu" class="flex items-center gap-3">
        <img alt="RUMAT STUDIO logo" class="h-9 w-9 object-contain" src="assets/logo.svg">
        <span id="brandText" class="uppercase text-sm tracking-widest">
          <span class="strong">RUMAT</span>&nbsp;<span class="light">STUDIO</span>
        </span>
      </a>
      <!-- Nav (keskellä) -->
      <nav id="mainNav" class="">
        <a href="#etusivu"  class="hover:underline underline-offset-4 font-semibold">Etusivu</a>
        <a href="#kaaviot"  class="hover:underline underline-offset-4 font-semibold">Kaavat</a>
        <a href="#tarina"   class="hover:underline underline-offset-4 font-semibold">Tarina</a>
        <a href="#blogi"    class="hover:underline underline-offset-4 font-semibold">Blogi</a>
        <a href="#some"     class="hover:underline underline-offset-4 font-semibold">Some</a>
        <a href="#yhteys"   class="hover:underline underline-offset-4 font-semibold">Yhteystiedot</a>
      </nav>
      <!-- Oikea reuna -->
      <div id="rightBlock" class="flex items-center gap-2">
        <!-- ☰ näkyy vasta kun nav ei mahdu -->
        <button id="openMenu" class="icon-btn hidden" aria-controls="menuDrawer" aria-expanded="false" aria-label="Valikko">
          <span aria-hidden="true" style="font-size:20px;line-height:1">☰</span>
          <span class="sr-only">Valikko</span>
        </button>
        <!-- Ostoskori tekstinä (nav mahtuu) -->
        <button id="openCartText" class="cart-text-btn">Ostoskori <span id="cartCountText" class="opacity-80"></span></button>
        <!-- Ostoskori ikonina (nav ei mahdu) -->
        <button id="openCartIcon" class="icon-btn hidden" aria-label="Ostoskori">
          <svg aria-hidden="true" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="9" cy="20" r="1.8"></circle><circle cx="17" cy="20" r="1.8"></circle><path d="M3 4h2l2.2 10.2a2 2 0 0 0 2 1.6h7.7a2 2 0 0 0 2-1.6L21 8H7.1"></path>
          </svg>
          <span class="badge" id="cartCount">0</span>
        </button>
      </div>
    </div>
  </header>

  <!-- SISÄLTÖ -->
  <main class="site-content pt-[72px]">
    <!-- HERO -->
    <section id="etusivu" class="hero px-4">
      <div id="hero-text" class="mt-10">
        <h1 class="text-[clamp(22px,4.8vw,58px)] tracking-[0.08em] drop-shadow-[0_2px_16px_rgba(0,0,0,0.40)]">
          Liian rumat ollakseen totta
        </h1>
        <div class="mt-8 flex justify-center">
          <img alt="RUMAT STUDIO logo" class="h-24 w-24 sm:h-28 sm:w-28 object-contain" src="assets/logo.svg">
        </div>
      </div>
    </section>

    <!-- Esittely (kuva – teksti – kuva) -->
    <section class="py-0">
      <div class="band full-bleed">
        <div class="band-inner">
          <div class="intro-grid">
            <img class="intro-img" src="https://images.unsplash.com/photo-1503341455253-b2e723bb3dbb?q=80&w=1200&auto=format&fit=crop" alt="Kuva 1">
            <p id="intro-text" class="text-lg sm:text-xl text-center md:text-left">
              <strong>Luonnosta syntynyt. Reissuissa testattu.</strong>
              Suunnittelemani neuleet ja asusteet kulkevat mukana poluilla ja kaupungissa – jotta sinulla on päälläsi jotain, joka istuu, hengittää ja kestää jokaisella askeleella.
              Jokainen vaate neulotaan käsin Suomussalmella yhden tekijän toimesta.
            </p>
            <img class="intro-img" src="https://images.unsplash.com/photo-1512436991641-6745cdb1723f?q=80&w=1200&auto=format&fit=crop" alt="Kuva 2">
          </div>
        </div>
      </div>
    </section>
    <div class="aurora-gap full-bleed"></div>

    <!-- KAAVIOT / TUOTTEET -->
    <section id="kaaviot" class="py-0">
      <div class="band full-bleed">
        <div class="band-inner">
          <h2 class="text-3xl mb-4">Kaavat</h2>

          <!-- GRID -->
          <div id="patternsGrid" class="pattern-grid"></div>

          <!-- TÄHÄN TUODaan AVATTU TUOTE (rivin alle) -->
          <div id="detailMount"></div>
        </div>
      </div>
    </section>
    <div class="aurora-gap full-bleed"></div>

    <!-- BLOGI -->
    <section id="blogi" class="py-0">
      <div class="band band--mist full-bleed">
        <div class="band-inner">
          <h2 class="text-3xl mb-6">Blogi</h2>
          <div id="blogRoot" class="grid gap-6">
            <article class="card p-6 md:p-8">
              <h3 class="text-2xl mb-2">Matka rumaan kauneuteen</h3>
              <p class="text-[color:#202020]/80">Olen aina etsinyt materiaaleja, jotka kestävät oikeaa elämää: reissujen sateet, rinkan hiertämät olkaimet, kaupunkipäivien nopeat käännökset…</p>
            </article>
          </div>
        </div>
      </div>
    </section>
    <div class="aurora-gap full-bleed"></div>

    <!-- SOME -->
    <section id="some" class="py-0">
      <div class="band full-bleed">
        <div class="band-inner">
          <h2 class="text-3xl mb-6">Some</h2>
          <div class="grid md:grid-cols-2 gap-6">
            <div class="aspect-[9/16] rounded-xl border border-[rgba(0,0,0,.12)] overflow-hidden bg-black">
              <iframe id="igEmbed" class="w-full h-full" allowtransparency="true" frameborder="0" scrolling="no" loading="lazy"
                      src="https://www.instagram.com/p/DMXVRgGC1Bv/embed" style="display:block"></iframe>
            </div>
            <div class="aspect-[9/16] rounded-xl border border-[rgba(0,0,0,.12)] overflow-hidden bg-black">
              <iframe id="ttEmbed"
                src="https://www.tiktok.com/embed/v2/7525414518562753814"
                style="width:100%;height:100%;border:0;display:block"
                allow="encrypted-media;"
                allowfullscreen
                title="TikTok video"></iframe>
            </div>
          </div>
        </div>
      </div>
    </section>
    <div class="aurora-gap full-bleed"></div>

    <!-- TARINA -->
    <section id="tarina" class="py-0">
      <div class="band band--stone full-bleed">
        <div class="band-inner">
          <h2 class="text-3xl mb-4">Tarina</h2>
          <p>Pienet erät. Kestävä käyttö. Pohjoiset sävyt. Jokainen vaate neulotaan käsin Suomussalmella yhden tekijän toimesta — jotta se kestää vuosia ja tekijä näkyy.</p>
        </div>
      </div>
    </section>
    <div class="aurora-gap full-bleed"></div>

    <!-- FOOTER -->
    <footer id="yhteys" style="background:var(--olive); color:var(--ivory);">
      <div class="mx-auto max-w-6xl px-4 py-10 grid sm:grid-cols-3 gap-8">
        <div class="flex items-start gap-3">
          <div class="logo-mask" aria-hidden="true"></div>
          <div>
            <div class="uppercase tracking-wide">RUMAT STUDIO</div>
            <div class="text-sm mt-1 text-white/80">Suomussalmi — Contemporary textiles, built to last.</div>
          </div>
        </div>
        <div>
          <h5 class="text-sm text-white/80">Yhteys</h5>
          <ul class="mt-2 space-y-2 text-sm">
            <li><a href="mailto:hello@rumat.fi" class="hover:underline text-white">hello@rumat.fi</a></li>
            <li><a href="https://instagram.com/rumat.studio" target="_blank" rel="noreferrer" class="hover:underline text-white">Instagram</a></li>
            <li><span class="text-white">Kauppakatu 20, 89600 Suomussalmi</span></li>
          </ul>
        </div>
      </div>
      <div class="py-6 text-center text-xs text-white/80">© <span id="year"></span> RUMAT STUDIO</div>
    </footer>
  </main>

  <!-- OSTOSKORI DRAWER (vain välisumma – kaavat ovat digitaalisia) -->
  <div id="cartDrawer" class="drawer" aria-hidden="true">
    <div class="absolute inset-0 bg-black/40" id="closeCart" aria-label="Sulje ostoskori"></div>
    <div class="panel p-5 flex flex-col">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-xl font-semibold">Ostoskori</h3>
        <button id="closeCartX" class="text-stone-500 hover:text-stone-800">✕</button>
      </div>
      <div id="cartItems" class="flex-1 overflow-auto divide-y"></div>
      <div class="mt-4 space-y-3">
        <div class="text-sm grid grid-cols-2 gap-y-1">
          <div class="text-[color:#202020]/70">Välisumma</div><div class="text-right" id="subTotal">€0,00</div>
        </div>
        <button id="checkout" class="btn bg-[color:var(--deep-blue)] text-white">Maksa PayPalilla</button>
        <div id="paypalWarn" class="text-xs text-[color:#202020]/70"></div>
      </div>
    </div>
  </div>

  <!-- VALIKKO DRAWER -->
  <div id="menuDrawer" class="drawer" aria-hidden="true">
    <div class="absolute inset-0 bg-black/40" id="closeMenu" aria-label="Sulje valikko"></div>
    <div class="panel p-6 flex flex-col gap-4">
      <div class="flex items-center justify-between">
        <h3 class="text-xl font-semibold">Valikko</h3>
        <button id="closeMenuX" class="text-stone-500 hover:text-stone-800">✕</button>
      </div>
      <nav class="flex flex-col gap-3 text-lg">
        <a href="#etusivu" class="py-2 border-b" data-menu-close>Etusivu</a>
        <a href="#kaaviot" class="py-2 border-b" data-menu-close>Kaavat</a>
        <a href="#tarina"  class="py-2 border-b" data-menu-close>Tarina</a>
        <a href="#blogi"   class="py-2 border-b" data-menu-close>Blogi</a>
        <a href="#some"    class="py-2 border-b" data-menu-close>Some</a>
        <a href="#yhteys"  class="py-2"          data-menu-close>Yhteystiedot</a>
      </nav>
    </div>
  </div>

  <script>
  const fmtEUR = x => new Intl.NumberFormat('fi-FI',{style:'currency',currency:'EUR'}).format(x);
  const $ = s => document.querySelector(s);
  const $$ = s => Array.from(document.querySelectorAll(s));
  const el = (tag,attrs={},...kids)=>{ const n=document.createElement(tag);
    Object.entries(attrs).forEach(([k,v])=>{
      if(k==='class') n.className=v; else if(k==='html') n.innerHTML=v;
      else if(k.startsWith('on')) n.addEventListener(k.slice(2),v); else n.setAttribute(k,v);
    });
    kids.forEach(k=>{ if(k==null) return; if(typeof k==='string') n.appendChild(document.createTextNode(k)); else n.appendChild(k);});
    return n;
  };

  // HERO teksti kevyt liike (smooth)
  (function(){
    const hero=document.getElementById('etusivu'); const textEl=document.getElementById('hero-text'); const yearEl=document.getElementById('year');
    if (yearEl) yearEl.textContent = new Date().getFullYear();
    let heroTop=0, heroHeight=1, amp=0, ticking=false, lastY=0, reduce=false;
    function recalc(){ const r=hero.getBoundingClientRect(); heroTop=r.top+(scrollY||0); heroHeight=Math.max(1,hero.offsetHeight); amp=heroHeight*0.18; }
    const clamp=(v,a,b)=>Math.min(b,Math.max(a,v)); const ease=t=>1-(1-t)*(1-t);
    function update(){ ticking=false; if(reduce){ textEl.style.transform='translate3d(0,0,0)'; return; }
      const p=clamp((lastY-heroTop)/heroHeight,0,1); const ty=-amp*ease(clamp(p/.9,0,1));
      textEl.style.transform=`translate3d(0,${ty}px,0)`; }
    function onScroll(){ lastY=scrollY||0; if(!ticking){ ticking=true; requestAnimationFrame(update);} }
    function onResize(){ recalc(); onScroll(); }
    const mq=matchMedia('(prefers-reduced-motion: reduce)'); reduce=mq.matches; mq.addEventListener?.('change',e=>{reduce=e.matches; onScroll();});
    addEventListener('scroll',onScroll,{passive:true}); addEventListener('resize',()=>requestAnimationFrame(onResize),{passive:true});
    if('fonts' in document) document.fonts.ready.then(()=>{ recalc(); onScroll(); });
    recalc(); onScroll();
  })();

  // ===== Dummy KAAVIOT =====
  const KAAVIOT = [
    { id:'laukku',      name:'Laukku',       price:6.00, sizes:'One size', blurb:'Sling-laukku kaava (PDF).', images:[
      'https://placehold.co/1400x900?text=Laukku+1','https://placehold.co/1400x900?text=Laukku+2'
    ]},
    { id:'usva-paita',  name:'Usva paita',   price:7.00, sizes:'XS–XL',    blurb:'Rento paita raglan-hihoilla.', images:[
      'https://placehold.co/1400x900?text=Usva+1','https://placehold.co/1400x900?text=Usva+2'
    ]},
    { id:'neule-panta', name:'Neule panta',  price:5.00, sizes:'S–L',      blurb:'Helppo aloittelijalle.', images:[
      'https://placehold.co/1400x900?text=Panta+1','https://placehold.co/1400x900?text=Panta+2'
    ]},
    { id:'kauluri',     name:'Kauluri',      price:5.00, sizes:'One size', blurb:'Nopea viikonloppuprojekti.', images:[
      'https://placehold.co/1400x900?text=Kauluri+1','https://placehold.co/1400x900?text=Kauluri+2'
    ]},
    { id:'pipo',        name:'Pipo',         price:6.00, sizes:'S–L',      blurb:'Peruspipo, selkeä ohje.', images:[
      'https://placehold.co/1400x900?text=Pipo+1','https://placehold.co/1400x900?text=Pipo+2'
    ]},
    { id:'lapaset',     name:'Lapaset',      price:6.00, sizes:'S–XL',     blurb:'Tiivis peruslapanen.', images:[
      'https://placehold.co/1400x900?text=Lapaset+1','https://placehold.co/1400x900?text=Lapaset+2'
    ]},
    { id:'sukat',       name:'Sukat',        price:6.00, sizes:'36–46',    blurb:'Vahvistettu kantapää.', images:[
      'https://placehold.co/1400x900?text=Sukat+1','https://placehold.co/1400x900?text=Sukat+2'
    ]},
    { id:'villapaita',  name:'Villapaita',   price:8.00, sizes:'XS–XXL',   blurb:'Klassinen pyöröneule.', images:[
      'https://placehold.co/1400x900?text=Villapaita+1','https://placehold.co/1400x900?text=Villapaita+2'
    ]},
  ];

  // ===== OSTOSKORI (kevyt) =====
  let CART = JSON.parse(localStorage.getItem('cart')||'{}');
  function saveCart(){ localStorage.setItem('cart', JSON.stringify(CART)); updateBadge(); }
  function updateBadge(){
    const n = Object.values(CART).reduce((a,b)=>a+b,0);
    const ic = $('#cartCount'); const tx = $('#cartCountText');
    if(ic) ic.textContent = String(n);
    if(tx) tx.textContent = n ? `(${n})` : '';
  }
  const $drawer=$('#cartDrawer');
  function openCart(){ $drawer.classList.add('open'); renderCart(); }
  function closeCart(){ $drawer.classList.remove('open'); }
  $('#openCartText')?.addEventListener('click', openCart);
  $('#openCartIcon')?.addEventListener('click', openCart);
  $('#closeCart')?.addEventListener('click', closeCart);
  $('#closeCartX')?.addEventListener('click', closeCart);
  function renderCart(){
    const root = $('#cartItems'); root.innerHTML='';
    let sub=0;
    Object.entries(CART).forEach(([id,q])=>{
      const p = KAAVIOT.find(x=>x.id===id); if(!p) return;
      sub += p.price*q;
      root.appendChild(el('div',{class:'py-3 flex items-center justify-between'},
        el('div',{},
          el('div',{class:'font-semibold'}, p.name),
          el('div',{class:'text-sm opacity-70'}, fmtEUR(p.price))
        ),
        el('button',{'data-remove':id, class:'px-2 border border-[rgba(0,0,0,.15)] rounded'}, 'Poista')
      ));
    });
    $('#subTotal').textContent = fmtEUR(sub);
    root.querySelectorAll('[data-remove]').forEach(b=>b.onclick=()=>{ const id=b.dataset.remove; delete CART[id]; saveCart(); renderCart(); });
  }
  function addToCart(id){ CART[id]=(CART[id]||0)+1; saveCart(); openCart(); }
  updateBadge();

  // ===== NAV: näytä ☰ + ostoskori-IKONI jos nav ei mahdu; muuten tekstit =====
  (function(){
    const container = document.getElementById('hdrRow');
    const brand     = document.getElementById('brandBlock');
    const nav       = document.getElementById('mainNav');
    const right     = document.getElementById('rightBlock');
    const menuBtn   = document.getElementById('openMenu');
    const cartIcon  = document.getElementById('openCartIcon');
    const cartText  = document.getElementById('openCartText');

    let navVisible = true;

    function measureNavWidth(){
      const wasHidden = nav.classList.contains('nav-hidden');
      if (wasHidden) nav.classList.remove('nav-hidden');
      nav.classList.add('nav-measure');
      const w = Math.ceil(nav.scrollWidth);
      nav.classList.remove('nav-measure');
      if (wasHidden) nav.classList.add('nav-hidden');
      return w;
    }
    function canShowNav(){
      // Piilota hetkeksi ☰ ja näytä ostoskori tekstinä, jotta mittaus on realistinen
      const mPrev = !menuBtn.classList.contains('hidden');
      const ciPrev = !cartIcon.classList.contains('hidden');
      const ctPrev = !cartText.classList.contains('hidden');
      menuBtn.classList.add('hidden'); cartIcon.classList.add('hidden'); cartText.classList.remove('hidden');

      const cw   = container.clientWidth;
      const bw   = Math.ceil(brand.getBoundingClientRect().width);
      const rbw  = Math.ceil(right.getBoundingClientRect().width);
      const navW = measureNavWidth();
      const fits = navW <= Math.max(0, cw - bw - rbw - 24);

      if (mPrev) menuBtn.classList.remove('hidden'); else menuBtn.classList.add('hidden');
      if (ciPrev) cartIcon.classList.remove('hidden'); else cartIcon.classList.add('hidden');
      if (!ctPrev) cartText.classList.add('hidden'); else cartText.classList.remove('hidden');

      return fits;
    }
    function applyState(showNav){
      navVisible = !!showNav;
      if (navVisible){
        nav.classList.remove('nav-hidden');
        menuBtn.classList.add('hidden');
        cartIcon.classList.add('hidden');
        cartText.classList.remove('hidden');
      }else{
        nav.classList.add('nav-hidden');
        menuBtn.classList.remove('hidden');
        cartIcon.classList.remove('hidden');
        cartText.classList.add('hidden');
      }
    }
    function compute(){ if (navVisible){ if (!canShowNav()) applyState(false); } else { if (canShowNav()) applyState(true); } }
    let t=null; const schedule=()=>{ if(t) return; t=setTimeout(()=>{ t=null; compute(); }, 120); };
    addEventListener('resize', schedule, {passive:true});
    if ('fonts' in document) document.fonts.ready.then(compute);
    compute();

    // Drawer perus
    (function(){
      const drawer = document.getElementById('menuDrawer');
      const openBtn = document.getElementById('openMenu');
      const closeA = document.getElementById('closeMenu');
      const closeX = document.getElementById('closeMenuX');
      function open(){ drawer.classList.add('open'); openBtn.setAttribute('aria-expanded','true'); }
      function close(){ drawer.classList.remove('open'); openBtn.setAttribute('aria-expanded','false'); }
      openBtn.addEventListener('click', open);
      closeA.addEventListener('click', close);
      closeX.addEventListener('click', close);
      drawer.addEventListener('click', e=>{ if(e.target===drawer) close(); });
      document.addEventListener('keydown', e=>{ if(e.key==='Escape') close(); });
      drawer.querySelectorAll('[data-menu-close]').forEach(a=>a.addEventListener('click', close));
    })();
  })();

  // ===== KAAVIOT UI =====
  (function(){
    const grid = $('#patternsGrid');
    const mount = $('#detailMount');
    let selectedId = null;
    let currentImgIndex = 0;

    // render tiles
    KAAVIOT.forEach((p)=>{
      const tile = el('article',{class:'tile card', 'data-id':p.id},
        el('img',{src:p.images[0], alt:p.name}),
        el('div',{class:'tile-caption'}, p.name)
      );
      grid.appendChild(tile);
    });

    function getCols(){
      const cs = getComputedStyle(grid).gridTemplateColumns;
      return Math.max(1, cs.split(' ').length);
    }

    function rowEndIdxOf(index){
      const cols = getCols();
      const end = Math.min( ((Math.floor(index/cols)+1)*cols)-1, grid.children.length-1 );
      return end;
    }

    function clearSelection(){
      // revert selected tile
      if (!selectedId) return;
      const prev = grid.querySelector(`.tile[data-id="${selectedId}"]`);
      if (prev){
        const p = KAAVIOT.find(x=>x.id===selectedId);
        prev.className='tile card';
        prev.innerHTML='';
        prev.appendChild(el('img',{src:p.images[0], alt:p.name}));
        prev.appendChild(el('div',{class:'tile-caption'}, p.name));
      }
      // remove detail
      mount.innerHTML='';
      selectedId=null;
    }

    function renderDetail(p){
      currentImgIndex=0;
      mount.innerHTML='';
      const box = el('div',{class:'detail card', id:'detailBox'},

        // Viewer (vasen)
        el('div',{class:'viewer'},
          el('img',{id:'viewerImg', src:p.images[0], alt:p.name}),
          el('button',{class:'navbtn prev', onclick:()=>nav(-1)}, '◀'),
          el('button',{class:'navbtn next', onclick:()=>nav(+1)}, '▶')
        ),

        // Right: kuvaus
        el('div',{},
          el('h3',{class:'text-2xl mb-2'}, p.name),
          el('p',{class:'opacity-80 mb-2'}, p.blurb),
          el('div',{class:'mb-3'}, el('span',{class:'font-semibold'}, 'Koot: '), p.sizes),
          el('div',{class:'text-xl font-bold mb-4'}, fmtEUR(p.price)),
          el('button',{class:'btn bg-[color:var(--deep-blue)] text-white', onclick:()=>addToCart(p.id)}, 'Osta')
        )
      );
      mount.appendChild(box);

      function nav(dir){
        const imgs=p.images; currentImgIndex=(currentImgIndex+dir+imgs.length)%imgs.length;
        $('#viewerImg').src = imgs[currentImgIndex];
      }
    }

    function selectTile(tile){
      const id = tile.getAttribute('data-id');
      if (id===selectedId){ return; }
      // reset previous
      clearSelection();

      // mark new selected
      selectedId = id;
      tile.className='tile tile--selected card';
      tile.innerHTML='';
      const minBtn = el('button',{class:'min-link', onclick:(e)=>{ e.stopPropagation(); clearSelection(); }}, 'pienennä');
      tile.appendChild(minBtn);

      // insert detail below the row containing tile
      const index = Array.prototype.indexOf.call(grid.children, tile);
      const endIdx = rowEndIdxOf(index);
      const afterNode = grid.children[endIdx];
      // move mount right after that node
      afterNode.after(mount);
      const p = KAAVIOT.find(x=>x.id===id);
      renderDetail(p);
      // scroll detail into view on mobile
      setTimeout(()=>{ mount.scrollIntoView({behavior:'smooth', block:'start'}); }, 0);
    }

    grid.addEventListener('click', (e)=>{
      const tile = e.target.closest('.tile'); if(!tile || !grid.contains(tile)) return;
      selectTile(tile);
    });

    // Reflow: if selected and cols change, reinsert mount under the correct row
    let rt=null;
    addEventListener('resize', ()=>{ if(rt) cancelAnimationFrame(rt); rt=requestAnimationFrame(()=>{
      if(!selectedId) return;
      const tile = grid.querySelector(`.tile[data-id="${selectedId}"]`);
      if(!tile) return;
      const i = Array.prototype.indexOf.call(grid.children, tile);
      const endIdx = rowEndIdxOf(i);
      const afterNode = grid.children[endIdx];
      afterNode.after(mount);
    }); });

    // year
    const y = $('#year'); if(y) y.textContent = new Date().getFullYear();
  })();

  // PayPal demo (tässä vain demo; aseta oma business-sähköposti jos käytät oikeasti)
  document.getElementById('checkout').addEventListener('click', ()=>{
    const ids = Object.keys(CART);
    if(ids.length===0) return alert('Ostoskori on tyhjä.');
    const email = "kauppa@esimerkki.fi";
    const form = el('form',{method:'POST', action:'https://www.paypal.com/cgi-bin/webscr', target:'_blank'},
      el('input',{type:'hidden',name:'cmd',value:'_cart'}),
      el('input',{type:'hidden',name:'upload',value:'1'}),
      el('input',{type:'hidden',name:'business',value:email}),
      el('input',{type:'hidden',name:'currency_code',value:'EUR'}),
      el('input',{type:'hidden',name:'return',value: location.origin+'/#success'}),
      el('input',{type:'hidden',name:'cancel_return',value: location.origin+'/#cancel'})
    );
    let i=1;
    ids.forEach(id=>{
      const p = KAAVIOT.find(x=>x.id===id); if(!p) return;
      form.appendChild(el('input',{type:'hidden',name:`item_name_${i}`,value:p.name}));
      form.appendChild(el('input',{type:'hidden',name:`amount_${i}`,   value:Number(p.price||0).toFixed(2)}));
      form.appendChild(el('input',{type:'hidden',name:`quantity_${i}`, value:1}));
      i++;
    });
    document.body.appendChild(form); form.submit(); form.remove();
  });

  // Valikko drawer sulkemiset
  (function(){
    const drawer = document.getElementById('menuDrawer');
    const openBtn = document.getElementById('openMenu');
    const closeA = document.getElementById('closeMenu');
    const closeX = document.getElementById('closeMenuX');
    function open(){ drawer.classList.add('open'); openBtn.setAttribute('aria-expanded','true'); }
    function close(){ drawer.classList.remove('open'); openBtn.setAttribute('aria-expanded','false'); }
    openBtn.addEventListener('click', open);
    closeA.addEventListener('click', close);
    closeX.addEventListener('click', close);
    drawer.addEventListener('click', e=>{ if(e.target===drawer) close(); });
    document.addEventListener('keydown', e=>{ if(e.key==='Escape') close(); });
    drawer.querySelectorAll('[data-menu-close]').forEach(a=>a.addEventListener('click', close));
  })();
  </script>
</body>
</html>
