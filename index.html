<!doctype html>
<html lang="fi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>RUMAT STUDIO</title>

  <!-- Montserrat -->
  <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800;900&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root{
      --ink:#202020;         /* tekstit */
      --olive:#A1A266;       /* footer-tausta */
      --deep-blue:#345563;   /* otsikot */
      --blue:#789FAB;        /* varalle */
      --light-blue:#DEEEEE;  /* footer-linkit + logo */
      --ivory:#F6F6F4;       /* taustat & yläpalkki */

      --header-h:56px;
      --section-gap: clamp(6px, 1vw, 12px);
      --band-radius: 16px;

      /* Esittelyn mitat */
      --intro-h: clamp(260px, 34vw, 360px);
      --intro-side: clamp(220px, 30vw, 380px);
      --intro-gap: 14px;
    }
    html{ scroll-padding-top: var(--header-h); }
    body{ font-family:Montserrat,system-ui,Segoe UI,Roboto,Arial; color:var(--ink); background:var(--ivory); }

    /* Otsikot */
    h1,h2,h3{ color:var(--deep-blue); font-weight:800; }
    .hero h1{ color:var(--ivory); }

    /* Full-bleed + bandit */
    .full-bleed{ margin-left: calc(50% - 50vw); margin-right: calc(50% - 50vw); }
    .band{ background:#fff; border-radius: var(--band-radius); overflow:hidden; }
    .band-inner{ max-width: 72rem; margin:0 auto; padding: 3rem 1rem; }
    .aurora-gap{ height: var(--section-gap); pointer-events: none; background: transparent; }

    /* Header */
    header{ background:var(--ivory); border-bottom:1px solid rgba(0,0,0,.08); }
    #hdrRow{ grid-template-columns:auto 1fr auto; }
    #brandText{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:min(42vw, 460px); color:var(--ink); }
    #brandText .strong{ font-weight:800; }
    #brandText .light{ font-weight:600; }

    #mainNav{ justify-self:center; display:flex; gap:1.5rem; white-space:nowrap; font-size:13px; text-transform:uppercase; letter-spacing:.2em; color:var(--ink); }
    #mainNav a{ color:var(--ink); }
    .nav-hidden{ display:none !important; }
    .nav-measure{ position:absolute !important; visibility:hidden !important; display:flex !important; white-space:nowrap !important; }

    /* Oikea reuna */
    .icon-btn{ position:relative; width:38px; height:38px; display:grid; place-items:center; border-radius:9999px; background:rgba(0,0,0,0.06); border:1px solid rgba(0,0,0,0.16); color:var(--ink); }
    .icon-btn:hover{ background:rgba(0,0,0,0.10); }
    .cart-text-btn{ border:1px solid rgba(0,0,0,.16); padding:.45rem .8rem; border-radius:9999px; color:var(--ink); background:rgba(0,0,0,.04); }
    .cart-text-btn:hover{ background:rgba(0,0,0,.08); }
    .badge{ position:absolute; top:-4px; right:-4px; min-width:18px; height:18px; padding:0 4px; display:grid; place-items:center; border-radius:9999px; background:var(--ink); color:#fff; font-size:11px; font-weight:700; border:1px solid rgba(0,0,0,.15); }

    /* HERO video tausta */
    .bg-video{
      position:fixed; inset:0; width:100%; height:100%;
      z-index:0; object-fit:cover; object-position:center;
      background:transparent; pointer-events:none;
    }
    .site-content{ position:relative; z-index:2; }
    .hero{ position:relative; height:100svh; display:grid; place-items:center; text-align:center; }

    /* Esittely (kuvat reunoista) */
    .intro-wrap.full-bleed{ border-radius: 20px; overflow: hidden; }
    .intro-edge{ position:relative; height: var(--intro-h); display:flex; align-items:center; justify-content:center; background: var(--ivory); }
    .intro-center{ position: relative; z-index: 1; max-width: 48rem; padding: 0 1rem; padding-left:  calc(var(--intro-side) + var(--intro-gap)); padding-right: calc(var(--intro-side) + var(--intro-gap)); text-align: left; }
    .intro-center p{ margin:0 0 .7rem 0; }
    .intro-logo{ width:56px; height:56px; display:block; margin:0 auto 1rem; object-fit:contain; }
    .edge-img{ position:absolute; top:50%; transform: translateY(-50%); width: var(--intro-side); height: calc(var(--intro-h)); }
    .edge-img img{ width:100%; height:100%; object-fit:cover; border-radius: 18px; border:1px solid rgba(0,0,0,.12); }
    .edge-img--left{ left:0; } .edge-img--right{ right:0; }
    @media (max-width: 900px){
      .intro-edge{ height:auto; display:block; }
      .edge-img{ position:relative; top:auto; transform:none; width:100%; height: 220px; }
      .intro-center{ padding: 1.25rem; padding-left:1.25rem; padding-right:1.25rem; }
      .intro-logo{ margin-top:.5rem; }
    }

    /* Kaaviot-galleria (neliöt) */
    .card{ background:#fff; border-radius:16px; border:1px solid rgba(0,0,0,.12); overflow:hidden; }
    .pattern-grid{ display:grid; grid-template-columns: repeat(2,minmax(0,1fr)); gap:12px; }
    @media (min-width: 768px){ .pattern-grid{ grid-template-columns: repeat(4,minmax(0,1fr)); gap:14px; } }
    .tile{ position:relative; cursor:pointer; aspect-ratio:1/1; display:block; }
    .tile img{ width:100%; height:100%; object-fit:cover; display:block; }
    .tile-caption{
      position:absolute; left:0; right:0; bottom:0;
      padding:.45rem .65rem;
      background: linear-gradient(to top, rgba(0,0,0,.55), rgba(0,0,0,.0));
      color:#fff; font-weight:700; letter-spacing:.06em; text-transform:uppercase; font-size:.85rem;
    }
    .tile--selected{ outline:2px solid var(--deep-blue); }

    /* “pienennä” koko laatan kokoinen */
    .min-full{
      position:absolute; inset:0; width:100%; height:100%;
      display:grid; place-items:center;
      border:0; background:rgba(0,0,0,.04); cursor:pointer;
      font-weight:800; color:var(--deep-blue); text-decoration:underline;
    }
    .min-full:hover{ background:rgba(0,0,0,.08); }

    /* Inline-laajennus (koko ruudukon leveys) */
    .expander{
      grid-column: 1 / -1;
      background:#fff; border-radius:16px; border:1px solid rgba(0,0,0,.12);
      overflow:hidden;
    }
    .ex-row{ display:grid; grid-template-columns:1fr; min-height:260px; }
    @media (min-width: 1024px){ .ex-row{ grid-template-columns: 1.6fr 1fr; } }
    .ex-view{ position:relative; background:#000; min-height:260px; }
    .ex-view img{ width:100%; height:100%; object-fit:contain; background:#000; }
    .ex-prev,.ex-next{
      position:absolute; top:50%; transform:translateY(-50%);
      width:42px; height:42px; display:grid; place-items:center;
      border-radius:9999px; background:#fff; border:1px solid rgba(0,0,0,.15); font-weight:800;
    }
    .ex-prev{ left:10px; } .ex-next{ right:10px; }
    .ex-info{ padding:1rem 1.1rem; overflow:auto; }
    .ex-top{ display:flex; align-items:center; justify-content:space-between; gap:.75rem; padding:.6rem .9rem; border-bottom:1px solid rgba(0,0,0,.1); }
  </style>
</head>

<body>
  <!-- HERO-VIDEO -->
  <video class="bg-video" id="bgVideo" autoplay muted loop playsinline poster="assets/aurora-poster.jpg">
    <source src="assets/aurora.webm" type="video/webm">
    <source src="assets/aurora.mp4"  type="video/mp4">
  </video>

  <!-- HEADER -->
  <header class="fixed top-0 left-0 right-0 z-50">
    <div id="hdrRow" class="mx-auto max-w-6xl px-4 py-3 grid items-center gap-3">
      <a id="brandBlock" href="#etusivu" class="flex items-center gap-3">
        <img alt="RUMAT STUDIO logo" class="h-9 w-9 object-contain" src="assets/logo.svg">
        <span id="brandText" class="uppercase text-sm tracking-widest">
          <span class="strong">RUMAT</span>&nbsp;<span class="light">STUDIO</span>
        </span>
      </a>
      <nav id="mainNav">
        <a href="#etusivu"       class="hover:underline underline-offset-4 font-semibold">Etusivu</a>
        <a href="#kaaviot"       class="hover:underline underline-offset-4 font-semibold">Kaavat</a>
        <a href="#suunnittelija" class="hover:underline underline-offset-4 font-semibold">Suunnittelija</a>
        <a href="#yhteys"        class="hover:underline underline-offset-4 font-semibold">Yhteystiedot</a>
      </nav>
      <div id="rightBlock" class="flex items-center gap-2">
        <button id="openMenu" class="icon-btn hidden" aria-controls="menuDrawer" aria-expanded="false" aria-label="Valikko">
          <span aria-hidden="true" style="font-size:20px;line-height:1">☰</span>
          <span class="sr-only">Valikko</span>
        </button>
        <button id="openCartText" class="cart-text-btn">Ostoskori <span id="cartCountText" class="opacity-80"></span></button>
        <button id="openCartIcon" class="icon-btn hidden" aria-label="Ostoskori">
          <svg aria-hidden="true" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="9" cy="20" r="1.8"></circle><circle cx="17" cy="20" r="1.8"></circle><path d="M3 4h2l2.2 10.2a2 2 0 0 0 2 1.6h7.7a2 2 0 0 0 2-1.6L21 8H7.1"></path>
          </svg>
          <span class="badge" id="cartCount">0</span>
        </button>
      </div>
    </div>
  </header>

  <!-- CONTENT -->
  <main class="site-content pt-[72px]">
    <!-- HERO -->
    <section id="etusivu" class="hero px-4">
      <div id="hero-text" class="mt-10">
        <h1 class="text-[clamp(22px,4.8vw,58px)] tracking-[0.08em] drop-shadow-[0_2px_16px_rgba(0,0,0,0.40)]">
          Liian rumat ollakseen totta
        </h1>
        <div class="mt-8 flex justify-center">
          <img alt="RUMAT STUDIO logo" class="h-24 w-24 sm:h-28 sm:w-28 object-contain" src="assets/logo.svg">
        </div>
      </div>
    </section>

    <!-- Esittely -->
    <section class="py-0">
      <div class="intro-wrap full-bleed">
        <div class="intro-edge">
          <div class="edge-img edge-img--left" aria-hidden="true">
            <img src="assets/intro-left.jpg" alt="">
          </div>
          <div class="intro-center">
            <img class="intro-logo" src="assets/logo.svg" alt="RUMAT STUDIO">
            <div id="intro-text" class="text-[15px] sm:text-base"></div>
          </div>
          <div class="edge-img edge-img--right" aria-hidden="true">
            <img src="assets/intro-right.jpg" alt="">
          </div>
        </div>
      </div>
    </section>
    <div class="aurora-gap full-bleed"></div>

    <!-- KAAVIOT (neliöt + inline-laajennus) -->
    <section id="kaaviot" class="py-0">
      <div class="band full-bleed">
        <div class="band-inner">
          <h2 class="text-3xl mb-4">Kaavat</h2>
          <div id="patternsGrid" class="pattern-grid"></div>
        </div>
      </div>
    </section>
    <div class="aurora-gap full-bleed"></div>

    <!-- SUUNNITTELIJA -->
    <section id="suunnittelija" class="py-0">
      <div class="band full-bleed" style="background:#f5f5f4">
        <div class="band-inner">
          <div class="designer-grid">
            <div class="designer-image">
              <img src="assets/designer.jpg"
                   onerror="this.onerror=null;this.src='https://images.unsplash.com/photo-1517445312885-9d7f7d7b4c53?q=80&w=1200&auto=format&fit=crop';"
                   alt="Suunnittelija">
            </div>
            <div class="designer-copy">
              <h2 class="text-3xl designer-title mb-4">Suunnittelija</h2>
              <div class="space-y-4">
                <p>
                  Aaltonen on itsevarma neuloja, joka ei rajoita luovuuttaan vain yhteen tekemisen tapaan.
                  Neulomisen rinnalla myös asusteiden ompelu on tärkeä osa ilmaisua – ja ennen kaikkea intohimo.
                  Lapsuuden kiinnostus vaatteiden suunnitteluun johti muodin ja tekstiilisuunnittelun opintoihin vuonna 2021.
                </p>
                <p>
                  Pian Aaltonen valmistuu taiteen maisteriksi, mukanaan vankka osaaminen ja omat suosikkitekniikat,
                  joita hän on hionut opintojen aikana. Neulomisen ja asusteiden lisäksi Aaltonen on syventynyt erityisesti
                  vaatteiden kierrätykseen, korjaamiseen liittyviin asenteisiin sekä kriittiseen tarkasteluun siitä,
                  miten kuluttamista ohjataan – ja millaisia seurauksia sillä on ympäristölle.
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <div class="aurora-gap full-bleed"></div>

    <!-- FOOTER -->
    <footer id="yhteys" class="footer-bar">
      <div class="footer-grid">
        <div class="footer-col">
          <h6>Instagram</h6>
          <a class="footer-handle" href="https://instagram.com/rumat.studio" target="_blank" rel="noreferrer">rumat.studio</a>
          <div style="height:.9rem"></div>
          <h6>TikTok</h6>
          <a class="footer-handle" href="https://www.tiktok.com/@rumat.studio" target="_blank" rel="noreferrer">rumat.studio</a>
        </div>
        <div class="footer-col">
          <h6>Ota yhteyttä</h6>
          <a class="footer-link" href="mailto:hello@rumat.fi">hello@rumat.fi</a>
          <div class="footer-ytunnus">Y-3436822-5</div>
        </div>
        <div class="footer-logo" aria-hidden="true"></div>
      </div>
      <div class="footer-copy">© <span id="year"></span> RUMAT STUDIO</div>
    </footer>
  </main>

  <!-- OSTOSKORI -->
  <div id="cartDrawer" class="drawer" aria-hidden="true">
    <div class="absolute inset-0 bg-black/40" id="closeCart" aria-label="Sulje ostoskori"></div>
    <div class="panel p-5 flex flex-col" style="background:#fff">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-xl font-semibold">Ostoskori</h3>
        <button id="closeCartX" class="text-stone-500 hover:text-stone-800">✕</button>
      </div>
      <div id="cartItems" class="flex-1 overflow-auto divide-y"></div>
      <div class="mt-4 space-y-3">
        <div class="text-sm grid grid-cols-2 gap-y-1">
          <div class="text-[color:#202020]/70">Välisumma</div><div class="text-right" id="subTotal">€0,00</div>
        </div>
        <button id="checkout" class="btn bg-[color:var(--deep-blue)] text-white">Maksa PayPalilla</button>
        <div id="paypalWarn" class="text-xs text-[color:#202020]/70"></div>
      </div>
    </div>
  </div>

  <!-- VALIKKO DRAWER -->
  <div id="menuDrawer" class="drawer" aria-hidden="true">
    <div class="absolute inset-0 bg-black/40" id="closeMenu" aria-label="Sulje valikko"></div>
    <div class="panel p-6 flex flex-col gap-4" style="background:#fff">
      <div class="flex items-center justify-between">
        <h3 class="text-xl font-semibold">Valikko</h3>
        <button id="closeMenuX" class="text-stone-500 hover:text-stone-800">✕</button>
      </div>
      <nav class="flex flex-col gap-3 text-lg">
        <a href="#etusivu"       class="py-2 border-b" data-menu-close>Etusivu</a>
        <a href="#kaaviot"       class="py-2 border-b" data-menu-close>Kaavat</a>
        <a href="#suunnittelija" class="py-2 border-b" data-menu-close>Suunnittelija</a>
        <a href="#yhteys"        class="py-2"          data-menu-close>Yhteystiedot</a>
      </nav>
    </div>
  </div>

  <script>
  const fmtEUR = x => new Intl.NumberFormat('fi-FI',{style:'currency',currency:'EUR'}).format(x);
  const $ = s => document.querySelector(s);
  const el = (tag,attrs={},...kids)=>{ const n=document.createElement(tag);
    Object.entries(attrs).forEach(([k,v])=>{
      if(k==='class') n.className=v; else if(k==='html') n.innerHTML=v;
      else if(k.startsWith('on')) n.addEventListener(k.slice(2),v); else n.setAttribute(k,v);
    });
    kids.forEach(k=>{ if(k==null) return; if(typeof k==='string') n.appendChild(document.createTextNode(k)); else n.appendChild(k);});
    return n;
  };

  // Hero-parallax (kevyt)
  (function(){
    const hero=document.getElementById('etusivu'); const textEl=document.getElementById('hero-text');
    let heroTop=0, heroHeight=1, amp=0, ticking=false, lastY=0, reduce=false;
    function recalc(){ const r=hero.getBoundingClientRect(); heroTop=r.top+(scrollY||0); heroHeight=Math.max(1,hero.offsetHeight); amp=heroHeight*0.18; }
    const clamp=(v,a,b)=>Math.min(b,Math.max(a,v)); const ease=t=>1-(1-t)*(1-t);
    function update(){ ticking=false; if(reduce){ textEl.style.transform='translate3d(0,0,0)'; return; }
      const p=clamp((lastY-heroTop)/heroHeight,0,1); const ty=-amp*ease(clamp(p/.9,0,1));
      textEl.style.transform=`translate3d(0,${ty}px,0)`; }
    function onScroll(){ lastY=scrollY||0; if(!ticking){ ticking=true; requestAnimationFrame(update);} }
    const mq=matchMedia('(prefers-reduced-motion: reduce)'); reduce=mq.matches; mq.addEventListener?.('change',e=>{reduce=e.matches; onScroll();});
    addEventListener('scroll',onScroll,{passive:true}); addEventListener('resize',()=>{recalc(); onScroll();},{passive:true});
    if('fonts' in document) document.fonts.ready.then(()=>{ recalc(); onScroll(); });
    recalc(); onScroll();
  })();

  // Esittelyteksti
  function parasToHTML(s){ return String(s||'').trim().split(/\n\s*\n/).map(p=>`<p>${p.trim()}</p>`).join('\n'); }
  const defaultContent = {
    hero:{ headline:"Liian rumat ollakseen totta" },
    pitch: `RUMAT STUDIO syntyi lapsuuden haaveesta ja vuosien aikana kypsyneestä intohimosta vaatesuunnitteluun. Vuonna 2023 visio alkoi muovautumaan nykyiseen muotoonsa: ajattomia ja kestäviä vaatteita, jotka syntyvät harkitusta rakkaudesta ja intohimosta luovaan tekemiseen.

RUMAT STUDIO pohjautuu vahvaan arvopohjaan. Se ei ole pelkkä tuotemerkki, vaan se rohkaisee pohtimaan omaa kulutuskäyttäytymistä ja inspiroi tekemään itse tai ainakin arvostamaan vaatteiden alkuperää ja tekijöitä niiden takana.

Taustalla on halu luoda ajattomia, kestäviä ja harkiten suunniteltuja vaatteita vastalauseena kertakäyttöiselle pikamuodille. Jokainen vaate suunnitellaan kestämään sekä käytössä että ajassa. Suunnittelussa otetaan huomioon materiaalien laatu, vaatteen käyttötarkoitus ja visuaalinen ilme, mutta myös tuotannon ekologinen ja eettinen kestävyys. Käsityönä valmistetut vaatteet vaativat aikaa ja siten nostavat vaatteen arvoa niin konkreettisesti kuin tunnearvossakin.

Tulevaisuuden suunnitelmissa on oman studiollisen avaaminen pääkaupunkiseudulle. Tila toimisi kohtaamispaikkana, jossa voi sovittaa mallikappaleita, osallistua työpajoihin ja verkostoitua muiden kestävästä arvosta kiinnostuneiden muotoilijoiden, ompelijoiden ja suunnittelijoiden kanssa.

Jokainen “liian RUMAT ollakseen totta” -tuote on suunniteltu huolella merkityksellisyydestä käyttömukavuuteen asti. Tavoitteena ei ole täydellisyys, vaan rohkeus ja kehitys. Nimi RUMAT STUDIO viittaa juuri tähän: lapsen sallittuun keskeneräisyyteen, mutta tähdätä silti johonkin merkitykselliseen.`,
  };
  (function(){
    const h1 = document.querySelector('#hero-text h1'); if(h1) h1.textContent = defaultContent.hero.headline;
    const intro = document.getElementById('intro-text'); if(intro) intro.innerHTML = parasToHTML(defaultContent.pitch);
    const y = document.getElementById('year'); if (y) y.textContent = new Date().getFullYear();
  })();

  // Kaavat (data)
  const KAAVIOT = [
    { id:'laukku',      name:'Laukku',       price:6.00, sizes:'One size', blurb:'Sling-laukku kaava (PDF).', images:['https://placehold.co/1400x900?text=Laukku+1','https://placehold.co/1400x900?text=Laukku+2']},
    { id:'usva-paita',  name:'Usva paita',   price:7.00, sizes:'XS–XL',    blurb:'Rento paita raglan-hihoilla.', images:['https://placehold.co/1400x900?text=Usva+1','https://placehold.co/1400x900?text=Usva+2']},
    { id:'neule-panta', name:'Neule panta',  price:5.00, sizes:'S–L',      blurb:'Helppo aloittelijalle.', images:['https://placehold.co/1400x900?text=Panta+1','https://placehold.co/1400x900?text=Panta+2']},
    { id:'kauluri',     name:'Kauluri',      price:5.00, sizes:'One size', blurb:'Nopea viikonloppuprojekti.', images:['https://placehold.co/1400x900?text=Kauluri+1','https://placehold.co/1400x900?text=Kauluri+2']},
    { id:'pipo',        name:'Pipo',         price:6.00, sizes:'S–L',      blurb:'Peruspipo, selkeä ohje.', images:['https://placehold.co/1400x900?text=Pipo+1','https://placehold.co/1400x900?text=Pipo+2']},
    { id:'lapaset',     name:'Lapaset',      price:6.00, sizes:'S–XL',     blurb:'Tiivis peruslapanen.', images:['https://placehold.co/1400x900?text=Lapaset+1','https://placehold.co/1400x900?text=Lapaset+2']},
    { id:'sukat',       name:'Sukat',        price:6.00, sizes:'36–46',    blurb:'Vahvistettu kantapää.', images:['https://placehold.co/1400x900?text=Sukat+1','https://placehold.co/1400x900?text=Sukat+2']},
    { id:'villapaita',  name:'Villapaita',   price:8.00, sizes:'XS–XXL',   blurb:'Klassinen pyöröneule.', images:['https://placehold.co/1400x900?text=Villapaita+1','https://placehold.co/1400x900?text=Villapaita+2']},
  ];

  // OSTOSKORI
  let CART = JSON.parse(localStorage.getItem('cart')||'{}');
  function saveCart(){ localStorage.setItem('cart', JSON.stringify(CART)); updateBadge(); }
  function updateBadge(){ const n = Object.values(CART).reduce((a,b)=>a+b,0); const ic=$('#cartCount'); const tx=$('#cartCountText'); if(ic) ic.textContent=String(n); if(tx) tx.textContent = n ? `(${n})` : ''; }
  const $drawer=$('#cartDrawer'); function openCart(){ $drawer.classList.add('open'); renderCart(); } function closeCart(){ $drawer.classList.remove('open'); }
  $('#openCartText')?.addEventListener('click', openCart); $('#openCartIcon')?.addEventListener('click', openCart);
  $('#closeCart')?.addEventListener('click', closeCart); $('#closeCartX')?.addEventListener('click', closeCart);
  function renderCart(){
    const root = $('#cartItems'); root.innerHTML=''; let sub=0;
    Object.entries(CART).forEach(([id,q])=>{
      const p = KAAVIOT.find(x=>x.id===id); if(!p) return;
      sub += p.price*q;
      root.appendChild(el('div',{class:'py-3 flex items-center justify-between'},
        el('div',{}, el('div',{class:'font-semibold'}, p.name), el('div',{class:'text-sm opacity-70'}, fmtEUR(p.price))), el('button',{'data-remove':id, class:'px-2 border border-[rgba(0,0,0,.15)] rounded'}, 'Poista')
      ));
    });
    $('#subTotal').textContent = fmtEUR(sub);
    root.querySelectorAll('[data-remove]').forEach(b=>b.onclick=()=>{ const id=b.dataset.remove; delete CART[id]; saveCart(); renderCart(); });
  }
  function addToCart(id){ CART[id]=(CART[id]||0)+1; saveCart(); openCart(); }
  window.addToCart = addToCart; updateBadge();

  document.getElementById('checkout').addEventListener('click', ()=>{
    const ids = Object.keys(CART); if(ids.length===0) return alert('Ostoskori on tyhjä.');
    const email = "kauppa@esimerkki.fi";
    const form = el('form',{method:'POST', action:'https://www.paypal.com/cgi-bin/webscr', target:'_blank'},
      el('input',{type:'hidden',name:'cmd',value:'_cart'}),
      el('input',{type:'hidden',name:'upload',value:'1'}),
      el('input',{type:'hidden',name:'business',value:email}),
      el('input',{type:'hidden',name:'currency_code',value:'EUR'}),
      el('input',{type:'hidden',name:'return',value: location.origin+'/#success'}),
      el('input',{type:'hidden',name:'cancel_return',value: location.origin+'/#cancel'})
    );
    let i=1;
    ids.forEach(id=>{
      const p = KAAVIOT.find(x=>x.id===id); if(!p) return;
      form.appendChild(el('input',{type:'hidden',name:`item_name_${i}`,value:p.name}));
      form.appendChild(el('input',{type:'hidden',name:`amount_${i}`,   value:Number(p.price||0).toFixed(2)}));
      form.appendChild(el('input',{type:'hidden',name:`quantity_${i}`, value:1}));
      i++;
    });
    document.body.appendChild(form); form.submit(); form.remove();
  });

  // NAV: vaihto ☰/tekstikori kun nav ei mahdu
  (function(){
    const container = document.getElementById('hdrRow');
    const brand     = document.getElementById('brandBlock');
    const nav       = document.getElementById('mainNav');
    const right     = document.getElementById('rightBlock');
    const menuBtn   = document.getElementById('openMenu');
    const cartIcon  = document.getElementById('openCartIcon');
    const cartText  = document.getElementById('openCartText');
    let navVisible = true;

    function measureNavWidth(){
      const wasHidden = nav.classList.contains('nav-hidden');
      if (wasHidden) nav.classList.remove('nav-hidden');
      nav.classList.add('nav-measure');
      const w = Math.ceil(nav.scrollWidth);
      nav.classList.remove('nav-measure');
      if (wasHidden) nav.classList.add('nav-hidden');
      return w;
    }
    function canShowNav(){
      const cw   = container.clientWidth;
      const bw   = Math.ceil(brand.getBoundingClientRect().width);
      const rbw  = Math.ceil(right.getBoundingClientRect().width);
      const navW = measureNavWidth();
      return navW <= Math.max(0, cw - bw - rbw - 24);
    }
    function applyState(showNav){
      navVisible = !!showNav;
      if (navVisible){
        nav.classList.remove('nav-hidden');
        menuBtn.classList.add('hidden');
        cartIcon.classList.add('hidden');
        cartText.classList.remove('hidden');
      }else{
        nav.classList.add('nav-hidden');
        menuBtn.classList.remove('hidden');
        cartIcon.classList.remove('hidden');
        cartText.classList.add('hidden');
      }
    }
    function compute(){ if (navVisible){ if (!canShowNav()) applyState(false); } else { if (canShowNav()) applyState(true); } }
    let t=null; const schedule=()=>{ if(t) return; t=setTimeout(()=>{ t=null; compute(); }, 120); };
    addEventListener('resize', schedule, {passive:true});
    if ('fonts' in document) document.fonts.ready.then(compute);
    compute();

    // Drawer
    (function(){
      const drawer = document.getElementById('menuDrawer');
      const openBtn = document.getElementById('openMenu');
      const closeA = document.getElementById('closeMenu');
      const closeX = document.getElementById('closeMenuX');
      function open(){ drawer.classList.add('open'); openBtn.setAttribute('aria-expanded','true'); }
      function close(){ drawer.classList.remove('open'); openBtn.setAttribute('aria-expanded','false'); }
      openBtn.addEventListener('click', open);
      closeA.addEventListener('click', close);
      closeX.addEventListener('click', close);
      drawer.addEventListener('click', e=>{ if(e.target===drawer) close(); });
      document.addEventListener('keydown', e=>{ if(e.key==='Escape') close(); });
      drawer.querySelectorAll('[data-menu-close]').forEach(a=>a.addEventListener('click', close));
    })();
  })();

  // KAAVIOT UI – inline-laajennus rivin alle
  (function(){
    const grid  = document.getElementById('patternsGrid');
    let selectedId = null;
    let expander = null;       // uudelleenkäytettävä laajennuselementti
    let current  = null;       // valittu tuote
    let imgIdx   = 0;

    // Rakenna laatat
    KAAVIOT.forEach((p)=>{
      const tile = document.createElement('article');
      tile.className = 'tile card';
      tile.setAttribute('data-id', p.id);
      const img = document.createElement('img');
      img.src = (p.images||[])[0] || 'https://placehold.co/900?text=Kaava';
      img.alt = p.name;
      const cap = document.createElement('div');
      cap.className = 'tile-caption';
      cap.textContent = p.name;
      tile.appendChild(img); tile.appendChild(cap);
      grid.appendChild(tile);
    });

    function columns(){
      const cs = getComputedStyle(grid).gridTemplateColumns;
      return Math.max(1, cs.split(' ').length);
    }
    function insertAfterRow(tileEl){
      const tiles = Array.from(grid.querySelectorAll('.tile, .expander'));
      const onlyTiles = tiles.filter(n=>n.classList.contains('tile'));
      const idx = onlyTiles.indexOf(tileEl);
      const cols = columns();
      const rowEndIdx = Math.min(onlyTiles.length-1, Math.floor(idx/cols)*cols + (cols-1));
      const after = onlyTiles[rowEndIdx];
      if (expander.parentNode !== grid){
        grid.insertBefore(expander, after.nextSibling);
      }else{
        grid.insertBefore(expander, after.nextSibling);
      }
    }
    function buildExpander(){
      expander = el('div',{class:'expander'});
      const top = el('div',{class:'ex-top'},
        el('div',{id:'exTitle',class:'font-semibold'}, ''),
        el('button',{id:'exClose',class:'px-3 py-1 rounded border border-[rgba(0,0,0,.15)]'}, 'pienennä')
      );
      const row = el('div',{class:'ex-row'},
        el('div',{class:'ex-view'},
          el('img',{id:'exImg',alt:'Kaava'}),
          el('button',{id:'exPrev',class:'ex-prev'},'◀'),
          el('button',{id:'exNext',class:'ex-next'},'▶')
        ),
        el('div',{class:'ex-info'},
          el('h3',{id:'exName',class:'text-2xl mb-2'}, ''),
          el('p',{id:'exBlurb',class:'opacity-80 mb-2'}, ''),
          el('div',{class:'mb-2'}, el('span',{class:'font-semibold'},'Koot: '), el('span',{id:'exSizes'},'')),
          el('div',{id:'exPrice',class:'text-xl font-bold mb-4'}, ''),
          el('button',{id:'exBuy',class:'btn bg-[color:var(--deep-blue)] text-white'},'Osta')
        )
      );
      expander.appendChild(top); expander.appendChild(row);
      // tapahtumat
      expander.querySelector('#exPrev').addEventListener('click', ()=>nav(-1));
      expander.querySelector('#exNext').addEventListener('click', ()=>nav(+1));
      expander.querySelector('#exClose').addEventListener('click', ()=>clearSelection());
    }
    buildExpander();

    function openFor(p, tileEl){
      current = p; imgIdx = 0;
      expander.querySelector('#exTitle').textContent = p.name;
      expander.querySelector('#exName').textContent  = p.name;
      expander.querySelector('#exBlurb').textContent = p.blurb || '';
      expander.querySelector('#exSizes').textContent = p.sizes || '';
      expander.querySelector('#exPrice').textContent = fmtEUR(p.price||0);
      expander.querySelector('#exImg').src = (p.images||[])[0] || 'https://placehold.co/900?text=Kaava';
      expander.querySelector('#exBuy').onclick = () => window.addToCart ? window.addToCart(p.id) : null;

      // Sijoita laajennus oikean rivin perään
      insertAfterRow(tileEl);
    }
    function nav(dir){
      if(!current || !current.images || !current.images.length) return;
      const n = current.images.length;
      imgIdx = (imgIdx + dir + n) % n;
      expander.querySelector('#exImg').src = current.images[imgIdx];
    }

    function markSelected(tile, on){
      tile.classList.toggle('tile--selected', !!on);
      tile.innerHTML='';
      const imgSrc = (KAAVIOT.find(x=>x.id===tile.dataset.id)?.images||[])[0] || 'https://placehold.co/900?text=Kaava';
      tile.appendChild(Object.assign(document.createElement('img'),{src:imgSrc,alt:tile.dataset.id}));
      const cap = Object.assign(document.createElement('div'),{className:'tile-caption',textContent: KAAVIOT.find(x=>x.id===tile.dataset.id)?.name || ''});
      tile.appendChild(cap);
      if (on){
        const btn = Object.assign(document.createElement('button'),{className:'min-full',type:'button',textContent:'pienennä'});
        btn.addEventListener('click', (e)=>{ e.stopPropagation(); clearSelection(); });
        tile.appendChild(btn);
      }
    }

    function clearSelection(){
      if(!selectedId) return;
      const prev = grid.querySelector(`.tile[data-id="${selectedId}"]`);
      if (prev) markSelected(prev, false);
      if (expander.parentNode === grid) grid.removeChild(expander);
      selectedId = null; current = null; imgIdx = 0;
    }

    function selectTile(tile){
      const id = tile.getAttribute('data-id');
      if (id===selectedId){ clearSelection(); return; }
      clearSelection();
      selectedId = id;
      markSelected(tile, true);
      const p = KAAVIOT.find(x=>x.id===id);
      openFor(p, tile);
    }

    grid.addEventListener('click', (e)=>{
      const tile = e.target.closest('.tile'); if(!tile || !grid.contains(tile)) return;
      selectTile(tile);
    });

    // Reposi laajennus kun sarakemäärä muuttuu
    let roTimer=null;
    addEventListener('resize', ()=>{
      if(!selectedId || !expander.parentNode) return;
      if(roTimer) clearTimeout(roTimer);
      roTimer=setTimeout(()=>{
        const tile = grid.querySelector(`.tile[data-id="${selectedId}"]`);
        if(tile) insertAfterRow(tile);
      },120);
    }, {passive:true});
  })();
  </script>
</body>
</html>
